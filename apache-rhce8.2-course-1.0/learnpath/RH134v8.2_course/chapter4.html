<html>
<head>
  <title>第四章 使用ACL控制对文件的访问</title>
  <basefont face="Consolas" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308816 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: Consolas;
      font-size: 11pt;
    }
  </style>
</head>
<body>
<a name="8678"/>

<div>
<span><div><div><div><div><div><span style="font-size: 12pt; color: rgb(0, 0, 255); font-weight: bold;">第四章 使用ACL控制对文件的访问</span></div><div><br/></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>解释并设置文件的访问控制列表（ACL），以处理需要复杂用户和组访问权限的情况。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">章节：</span></div><ul><li><div>解释文件ACL</div></li><li><div>使用ACL保护文件安全</div></li></ul><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第一节：解释文件ACL</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能：</div></li><li><div>  描述ACL和文件系统挂载选项。</div></li><li><div>  使用ls和getfacl查看并解释ACL。</div></li><li><div>  描述ACL掩码和ACL权限优先级。</div></li><li><div>  确定默认情况下红帽企业Linux使用ACL的位置。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">访问控制列表概念：access control list（ACL）</span></div></div><ul><li><div>当文件仅由单个所有者和指定的一组人使用时，标准Linux文件权限即可满足要求。</div></li><li><div><span style="font-weight: bold;">但是，有些用例要求多个指定的用户和组以不同的文件权限集来访问文件。</span></div></li><li><div>访问控制列表便提供了该功能。</div></li></ul><div><br/></div><ul><li><div>借助ACL，可使用与常规文件权限相同的权限标志（读取、写入和执行）向由用户名、组名、</div></li></ul><div>     UID或GID标识的多个用户和组授予权限。</div><ul><li><div><span style="font-weight: bold;">除了文件所有者和文件的组从属关系之外，这些额外的用户和组分别被称为指定用户和指定组，</span></div></li></ul><div><span style="font-weight: bold;">     因为它们不是在长列表中指定的，而是在ACL中指定的。</span></div><div><br/></div><ul><li><div>用户可以对属于自己的文件和目录设置ACL。</div></li><li><div>被分配了 CAP_FOWNER Linux 功能的特权用户可以对任何文件或目录设置ACL。</div></li><li><div><span style="font-weight: bold;">新文件和子目录会自动从父目录的默认ACL（若已设置）中继承ACL设置。</span></div></li><li><div>与常规文件的访问规则相似，父目录层次结构至少需要其他搜索（执行）权限集，以便启用</div></li></ul><div>     指定用户和指定组的访问权限。</div><div><br/></div><div><span style="font-weight: bold;">文件系统ACL支持：</span></div><ul><li><div>文件系统需在挂载选项上启用ACL支持。</div></li><li><div><span style="font-weight: bold;">XFS文件系统内置ACL</span></div></li><li><div>RHEL8的 ext3 或 ext4 文件系统挂载默认启用 acl 选项。</div></li><li><div><span style="font-weight: bold;">要启用文件系统ACL支持，需在mount命令或/etc/fstab中有ACL挂载选项。</span></div></li><li><div><span style="font-weight: bold;">$ man 5 acl</span>：查看ACL相关的详细信息</div></li></ul><div><br/></div><div><span style="font-weight: bold;">查看和解释ACL权限：</span></div><ul><li><div>ls -l仅输出最少的ACL设置信息。</div></li></ul><div>     <img src="chapter4_files/Image.png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><ul><li><div>权限字符串末尾的加号（+）表示该文件存在ACL。</div></li><li><div><span style="font-weight: bold;">$ getfacl &lt;</span><span style="font-style: italic; font-weight: bold;">filename</span><span style="font-weight: bold;">&gt;</span>：查看文件的ACL</div></li></ul><div>     <img src="chapter4_files/Image [1].png" type="image/png" data-filename="Image.png" width="498"/></div><div>     <img src="chapter4_files/Image [2].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><div>   <span style="color: rgb(0, 0, 255); font-weight: bold;">* 注意：</span></div><div>     1. 父目录中的文件或子目录的权限由该父目录决定！</div><div>     <img src="chapter4_files/Image [3].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><div>     2. ACL中的mask值为有效ACL权限</div><div>     <img src="chapter4_files/Image [4].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><div>     3. 修改mask值后将影响ACL中已有的权限 </div><div>     <img src="chapter4_files/Image [5].png" type="image/png" data-filename="Image.png" width="497"/></div><div>     </div><div><span style="font-weight: bold;">查看目录ACL：</span></div><ul><li><div><span style="font-weight: bold;">$ getfacl &lt;</span><span style="font-style: italic; font-weight: bold;">directory</span><span style="font-weight: bold;">&gt;</span>：查看目录的ACL</div></li></ul><div>     <img src="chapter4_files/Image [6].png" type="image/png" data-filename="Image.png" width="498"/>          </div><div><br/></div><div><span style="font-weight: bold;">ACL掩码：mask</span></div></div><ul><li><div><span style="font-weight: bold;">ACL掩码定义可授予指定用户、组所有者和指定组的最大权限。</span></div></li><li><div>它不限制文件所有者或其他用户的权限。</div></li><li><div>所有实施ACL的文件和目录都将具有ACL掩码。</div></li><li><div>可使用getfacl查看掩码，并通过setfacl显式设置掩码。</div></li><li><div><span style="font-weight: bold;">如果未显式设置，系统会自动计算并添加掩码，但也可从父目录默认掩码设置中继承掩码。</span></div></li><li><div>默认情况下，每当添加、修改或删除任何受影响的ACL时，均会重新计算掩码。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">ACL权限优先级：ACL permission precedence</span></div><ul><li><div>在决定一个进程（正在运行的程序）能否访问文件时，将按如下所示应用文件权限和ACL。</div></li><li><div>如果正在以文件所有者身份运行进程，则应用文件的用户ACL权限。</div></li><li><div>如果正在以指定用户ACL条目中列出的用户身份运行进程，则应用指定用户ACL权限（只要掩码</div></li></ul><div>     允许）。</div><ul><li><div>如果正在以与文件的组所有者相匹配的组身份运行进程，或者以具有显式指定组ACL条目的</div></li></ul><div>     组身份运行进程，则应用相匹配的ACL权限（只要掩码允许）。</div><ul><li><div>否则，将应用文件的其他ACL权限。</div></li></ul><div><br/></div><div>     <span style="color: rgb(250, 122, 0); font-weight: bold;">练习 P97：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">INTERPRETING FILE ACLS </span></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第二节：使用ACL保护文件安全</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能：</div></li><li><div>  使用setfacl更改常规ACL文件权限。</div></li><li><div>  控制新文件和目录的默认ACL文件权限。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">更改ACL文件权限：</span></div><ul><li><div>使用<span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">setfacl</span>命令添加、修改或删除文件和目录的ACL。</div></li></ul><div>     1. r：读取权限</div><div>     2. w：写入权限</div><div>     3. x：执行权限</div><div>     4. <span style="font-weight: bold;">-</span>：缺少相关权限</div><div>     5. <span style="font-weight: bold;">X：若文件无相关的执行权限，则只设置目录（而非常规文件）的执行权限。</span></div><ul><li><div>使用 <span style="font-weight: bold;">-m</span> 选项设置ACL。</div></li><li><div>示例：</div></li></ul><div>     $ setfacl -m u:&lt;<span style="font-style: italic;">username</span>&gt;:rX &lt;<span style="font-style: italic;">filename</span>&gt;</div><div>     $ setfacl -m g:&lt;<span style="font-style: italic;">groupname</span>&gt;:rw &lt;<span style="font-style: italic;">filename</span>&gt;</div><div>     $ setfacl -m o::- &lt;<span style="font-style: italic;">filename</span>&gt;</div><div>     <span style="font-weight: bold;">$ setfacl -m u::rwx,g:&lt;</span><span style="font-style: italic; font-weight: bold;">groupname</span><span style="font-weight: bold;">&gt;:rX,o::- &lt;</span><span style="font-style: italic; font-weight: bold;">filename</span><span style="font-weight: bold;">&gt;</span></div><div>     </div><ul><li><div>使用getfacl作为输入：</div></li></ul><div><span style="font-weight: bold;">     $ getfacl &lt;</span><span style="font-style: italic; font-weight: bold;">file1</span><span style="font-weight: bold;">&gt; | setfacl --set-file=- &lt;</span><span style="font-style: italic; font-weight: bold;">file2</span><span style="font-weight: bold;">&gt;</span></div><div><span style="font-weight: bold;">     </span># <span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">--set-file</span> 选项可接受来自文件或STDIN的输入</div><div>     # 短划线字符（-）指定使用STDIN</div><div>     # 以上示例中，两个文件的ACL设置相同。</div><div>     <img src="chapter4_files/getfacl与setfacl管道.JPG" type="image/jpeg" data-filename="getfacl与setfacl管道.JPG" width="498"/></div><div><br/></div><ul><li><div>递归ACL修改：</div></li></ul><div>     1. 使用 <span style="font-weight: bold;">-R</span> 选项以递归方式应用ACL。</div><div>     2. <span style="font-weight: bold;">递归方式可能需要使用大写 X 权限，只有目录会设置执行权限，以允许进行目录搜索。</span></div><div>     3. 以非递归方式设置ACL时，最好也使用大写 X，可防止管理员意外向普通文件添加执行权限。</div><div>     <img src="chapter4_files/Image [7].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><ul><li><div>删除ACL：</div></li></ul><div>     1. <span style="font-weight: bold;">$ setfacl -x u:&lt;</span><span style="font-style: italic; font-weight: bold;">username</span><span style="font-weight: bold;">&gt; &lt;</span><span style="font-style: italic; font-weight: bold;">filename</span><span style="font-weight: bold;">&gt;</span>：从文件或目录ACL中删除指定用户和组</div><div>     2. 其他现有ACL条目均保持不变。</div><div>     <img src="chapter4_files/Image [8].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><div>     3. <span style="font-weight: bold;">掩码只能在未设置其他ACL的情况下删除，因此必须最后删除。</span></div><div>     4. 如下所示，删除文件或目录的所有ACL（包括目录默认ACL）。</div><div>     <img src="chapter4_files/Image [9].png" type="image/png" data-filename="Image.png" width="497"/></div><div>     <b><font style="color: rgb(0, 0, 255);">* 注意：</font></b>-b选项也可用于删除默认ACL<br/></div><div><br/></div><div><span style="font-weight: bold;">控制默认ACL文件权限：</span></div></div><ul><li><div>为了确保目录中创建的文件和目录继承ACL，需要在目录上使用默认ACL。</div></li><li><div><span style="font-weight: bold;">目录本身仍需要显式设置ACL，默认ACL仅提供ACL继承功能。</span></div></li></ul><div>     <img src="chapter4_files/Image [10].png" type="image/png" data-filename="Image.png" width="498"/></div><div>     <b><font style="color: rgb(54, 101, 238);">* 注意：</font></b><br/></div><div><span>    </span><span>   1. 若使用默认ACL继承，需显示设置目录的ACL，直接设置于默认ACL将无法生效！</span></div><div><span>    </span><span>   2. 默认ACL只对该目录中之后创建的文件或目录生效，之前创建的文件或目录依然</span></div><div><span><span><span><span>    </span><span>      保持原始权限。</span> </span>  </span><br/></span></div><div><br/></div><ul><li><div>默认ACL继承示例：</div></li></ul><div>     <img src="chapter4_files/1.JPG" type="image/jpeg" data-filename="1.JPG" width="498"/></div><div>     <img src="chapter4_files/2.JPG" type="image/jpeg" data-filename="2.JPG" width="499"/></div><div><span>     </span><img src="chapter4_files/3.JPG" type="image/jpeg" data-filename="3.JPG" width="500"/><br/></div><div><br/></div><div><span style="font-weight: bold;">删除默认ACL条目：</span></div><ul><li><div>删除默认ACL的方式与删除标准ACL一样，以 d: 开头，或使用 -d 选项。</div></li></ul><div>     <img src="chapter4_files/Image [11].png" type="image/png" data-filename="Image.png" width="498"/></div><ul><li><div><span style="font-weight: bold;">$ setfacl -k &lt;</span><span style="font-style: italic; font-weight: bold;">directory</span><span style="font-weight: bold;">&gt;</span>：删除目录的所有默认ACL条目</div></li></ul><div><br/></div><div>     <span style="color: rgb(250, 122, 0); font-weight: bold;">练习 P103：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">SECURING FILES WITH ACLS</span></div><div><span style="color: rgb(250, 122, 0); font-weight: bold;">     Lab P108：CONTROLLING ACCESS TO FILES WITH ACLS </span></div><div><br/></div></div><div><br/></div><div><br/></div></span>
</div></body></html> 