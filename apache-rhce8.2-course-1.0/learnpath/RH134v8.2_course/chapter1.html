<html>
<head>
  <title>第一章 提高命令行生产率</title>
  <basefont face="Consolas" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308816 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: Consolas;
      font-size: 11pt;
    }
  </style>
</head>
<body>
<a name="4076"/>

<div>
<span><div><div><div><span style="font-size: 12pt; color: rgb(0, 0, 255); font-weight: bold;">第一章 提高命令行生产率</span></div><div><img src="chapter1_files/Latest_rhel8_featuredimage.png" type="image/png" data-filename="Latest_rhel8_featuredimage.png" width="187"/></div><div><br/></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>通过使用Bash shell的高级功能、shell脚本以及RHEL所提供的各种实用程序，</div></li></ul><div>     可以更⾼效地运行命令。</div><div><br/></div><div><span style="font-weight: bold;">章节：</span></div><ul><li><div>编写简单的Bash脚本</div></li><li><div>使用循环更高效地运行命令</div></li><li><div>使用正则表达式匹配命令输出中的文本</div></li></ul><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第一节：编写简单的Bash脚本</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能通过编写简单的shell脚本来自动执行相应的命令序列。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">创建和执行Bash shell脚本：</span></div><ul><li><div>复杂的任务则通常需要将多个命令链接到一起并在它们之间传递结果。</div></li><li><div>借助Bash shell环境和脚本功能，可将Linux命令和shell脚本组合在一起，从而轻松地解决</div></li></ul><div>     重复而困难的实际问题。</div><ul><li><div>精通shell脚本编写是进行系统管理的必备要素。</div></li><li><div>脚本可以提高处理日常任务的效率和准确性。</div></li><li><div>高级编辑器（如vim或emacs）理解Bash shell语法并且提供语法高亮，有助于识别常见错误。</div></li></ul><div><br/></div><ul><li><div><span style="font-weight: bold;">脚本的第一行以符号 '#!' 开头，通常称为 sh-bang 或 she-bang。</span></div></li></ul><div>     <img src="chapter1_files/Image.png" type="image/png" data-filename="Image.png" width="497"/></div></div><div><br/></div><ul><li><div>shell脚本必须为可执行文件。</div></li><li><div>使用chmod命令可添加执行权限。</div></li><li><div><span style="font-weight: bold;">可将脚本放在shell的 PATH 环境变量中列出的目录中，即可直接输入脚本名来运行。</span></div></li></ul><div>     <img src="chapter1_files/Image [1].png" type="image/png" data-filename="Image.png" width="498"/>     </div><div><br/></div><div><span style="font-weight: bold;">对特殊字符加引号：</span></div><ul><li><div>一些字符和词语对Bash shell具有特殊含义。</div></li><li><div>有时希望使用这些字符的字面值，而非其特殊含义。</div></li><li><div>以下三种工具之一可以取消（或转义）特殊含义：</div></li></ul><div>     1. 反斜杠（\）</div><div>     2. 单引号（''）</div><div>     3. 双引号（&quot;&quot;）</div><div>     <img src="chapter1_files/Image [2].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><div><span style="font-weight: bold;">从Shell脚本提供输出：</span></div><ul><li><div>通过将文本作为参数传递给命令，echo命令可显示任意文本。</div></li><li><div>默认情况下，文本将在标准输出（STDOUT）上显示。</div></li></ul><div>     <img src="chapter1_files/Image [3].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><ul><li><div>也可以使用输出重定向将其定向到标准错误（STDERR）。</div></li></ul><div>     <img src="chapter1_files/Image [4].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><div>     <span style="color: rgb(250, 122, 0); font-weight: bold;">练习 P6：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">WRITING SIMPLE BASH SCRIPTS</span></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第二节：使用循环更高效地运行命令</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能：</div></li><li><div>  使用for循环迭代列表</div></li><li><div>  通过命令和脚本评估退出代码</div></li><li><div>  使用运算符执行测试</div></li><li><div>  使用if语句创建条件结构</div></li></ul><div><br/></div><div><span style="font-weight: bold;">使用循环来迭代命令：</span></div><ul><li><div>系统管理员在其日常活动中经常会遇到重复任务。</div></li><li><div><span style="font-weight: bold;">for循环是Bash提供的循环结构。</span></div></li><li><div>Bash的for循环结构使用以下语法：</div></li></ul><div>     <img src="chapter1_files/Image [5].png" type="image/png" data-filename="Image.png" width="498"/></div><div>     <img src="chapter1_files/Image [6].png" type="image/png" data-filename="Image.png" width="498"/></div><div>     <img src="chapter1_files/Image [7].png" type="image/png" data-filename="Image.png" width="499"/></div><div><br/></div><div>   <span style="color: rgb(0, 0, 255); font-weight: bold;">* Shell脚本示例：</span></div><div><span style="color: rgb(0, 0, 255); font-weight: bold;">     </span>1. for语句中的&quot;\&quot;转义与双引号圈引</div><div>     <img src="chapter1_files/Bash shell - for语句（1）.JPG" type="image/jpeg" data-filename="Bash shell - for语句（1）.JPG" width="577"/></div><div>    </div><div>     2. <span style="font-weight: bold;">IFS（内部字段分隔符）使用要点</span></div><div>     <img src="chapter1_files/Bash shell - for语句（2）.jpg" type="image/jpeg" data-filename="Bash shell - for语句（2）.jpg" width="579"/></div><div>     <img src="chapter1_files/Bash shell - for语句（3）.JPG" type="image/jpeg" data-filename="Bash shell - for语句（3）.JPG" width="578"/></div><div><br/></div><div>     3. case语句示例</div><div>     <img src="chapter1_files/Bash shell - case语句.PNG" type="image/png" data-filename="Bash shell - case语句.PNG" width="579"/></div><div><br/></div><div><span>     4. awk命令简单数值统计示例 </span><br/></div><div><span>     </span><img src="chapter1_files/cal_pg_num_per_pool.png" type="image/png" data-filename="cal_pg_num_per_pool.png" width="578"/></div><div><br/></div><div><span style="font-weight: bold;">在脚本中使用退出代码：</span></div><ul><li><div>在处理完所有内容后，脚本会退出到调用它的进程。</div></li><li><div>但是，有时候可能需要在完成之前退出脚本，比如在遇到错误条件时。</div></li><li><div>可在脚本中使用 <span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">exit</span> 命令来实现这一目的。</div></li><li><div><span style="font-weight: bold;">可使用整数参数（0 ~ 255 之间，表示退出代码）来执行exit命令。</span></div></li><li><div>退出代码是进程完成后返回的代码。</div></li><li><div><span style="font-weight: bold;">0 表示没有错误，非零值都表示存在错误。</span></div></li><li><div>可以使用不同的非零值来区分遇到的不同类型错误。</div></li><li><div>此退出代码传回到父进程，存储在 ? 变量中，并可通过 <span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">$?</span> 进行访问。</div></li></ul><div>     <img src="chapter1_files/Image [8].png" type="image/png" data-filename="Image.png" width="499"/></div><div><br/></div><div><span style="font-weight: bold;">测试脚本输入：</span></div><ul><li><div>可通过 <span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">test</span> 命令对脚本进行语法测试。</div></li></ul><div>     <img src="chapter1_files/Image [9].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><ul><li><div>可以使用Bash的测试语法 <span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">[ &lt;TESTEXPRESSION&gt; ]</span> 来执行测试：</div></li></ul><div>     1. Bash数字比较运算符：</div><div>     <img src="chapter1_files/Image [10].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><div>     2. 字符串比较运算符：</div><div>     <img src="chapter1_files/Image [11].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><div>     3. Bash的字符串一元运算符：</div><div>     <img src="chapter1_files/Image [12].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><div><span style="font-weight: bold;">条件判断结构：</span></div><ul><li><div><span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">if/then</span>结构：</div></li></ul><div>     1. Bash中最简单的条件结构是 if/then 结构，其语法如下：</div><div>     <img src="chapter1_files/Image [13].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><div>     2. 如果满足给定条件，将采取一个或多个操作。</div><div>     3. 如果不满足给定条件，则不采取任何操作。</div><div>     <img src="chapter1_files/Image [14].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><ul><li><div><span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">if/then/else</span>结构：</div></li></ul><div>     1. if/then结构可以进一步扩展，以便能够根据是否满足条件来采取不同的操作集合。</div><div>     <img src="chapter1_files/Image [15].png" type="image/png" data-filename="Image.png" width="498"/></div><div>     <img src="chapter1_files/Image [16].png" type="image/png" data-filename="Image.png" width="499"/></div><div><br/></div><ul><li><div><span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">if/then/elif/then/else</span>结构：</div></li></ul><div>     1. if/then/else结构可以进一步扩展以测试多个条件，在满足某个条件时执行不同的</div><div>        操作集合。</div><div>     <img src="chapter1_files/Image [17].png" type="image/png" data-filename="Image.png" width="497"/>     </div><div><br/></div><div>     2. 在此条件结构中，Bash将按照显示的顺序测试条件。</div><div>     3. 在发现某个条件成立后，Bash将执行和该条件相关联的操作，然后跳过条件结构的</div><div>        其余部分。</div><div>     4. 如果所有条件均不成立，Bash将执行 else 子句中的操作。</div><div>     <img src="chapter1_files/Image [18].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><div>   <span style="color: rgb(0, 0, 255); font-weight: bold;">* 示例：</span></div><div>     1. if/then语句基本使用</div><div>     <img src="chapter1_files/Bash shell - if语句（1）.PNG" type="image/png" data-filename="Bash shell - if语句（1）.PNG" width="578"/></div><div>     <img src="chapter1_files/Bash shell - if语句（2）.PNG" type="image/png" data-filename="Bash shell - if语句（2）.PNG" width="578"/></div><div><br/></div><div>     2. Bash中bc支持浮点数运算</div><div>     <img src="chapter1_files/Bash shell - if语句（3）.PNG" type="image/png" data-filename="Bash shell - if语句（3）.PNG" width="578"/></div><div><br/></div><div>     <span style="color: rgb(250, 122, 0); font-weight: bold;">练习 P15：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">RUNNING COMMANDS MORE EFFICIENTLY USING LOOPS</span></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第三节：使用正则表达式匹配命令输出中的文本</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能使用grep和正则表达式在日志和命令输出中进行模式匹配。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">正则表达式：regular expression</span></div><ul><li><div>正则表达式使用模式匹配机制查找特定内容。</div></li><li><div>vim、grep 和 less 命令都可以使用正则表达式。</div></li><li><div>Perl、Python 和 C 等编程语言在使用模式匹配条件时，也都会使用正则表达式。</div></li><li><div>正则表达式自成体系，该语言有其自身的语法和规则。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">描述正则表达式：</span></div><ul><li><div>最简单的正则是行中完全匹配。</div></li></ul><div>     $ grep cat /usr/share/dict/words</div><ul><li><div><span style="font-weight: bold;">^ ：开头匹配</span></div></li><li><div><span style="font-weight: bold;">$ ：末尾匹配</span></div></li></ul><div>     $ grep ^cat abc.txt; grep dog$ abc.txt</div><div><br/></div><ul><li><div>^cat$：匹配只有cat的行</div></li><li><div>c.t：匹配含有cat、c5t、cQt这样内容的行</div></li><li><div>c[aou]t：只匹配cat、cot、cut</div></li><li><div>c.*t：匹配cat、ct、coat、culvert等以c开头，t结尾的内容（不要写成c*t）。</div></li><li><div>c.\{2\}t：匹配c开头，t结尾，中间正好2个字符的内容，如coat。</div></li></ul><div>     <span style="font-weight: bold;">$ </span><span style="font-weight: bold;">grep 'c.\{2\}t' /usr/share/dict/words</span></div><div><br/></div><ul><li><div><span style="font-weight: bold;">$ man 7 regex</span>：查看正则表达式的使用方法</div></li></ul><div><br/></div><div>     <span style="color: rgb(0, 0, 255); font-weight: bold;">* 注意：</span></div><div>       1. 本课程介绍了两种不同的元字符文本解析系统：</div><div>          a. <span style="font-weight: bold;">shell模式匹配（也称为文件通配或文件名扩展）</span></div><div><span style="font-weight: bold;">    </span><span style="font-weight: bold;">     </span> b. <span style="font-weight: bold;">正则表达式</span></div><div>       2. 由于这两个系统都使用相似的元字符，如星号（*），但在元字符解释和规则方面存在</div><div>          差异，因此在完全掌握每种系统之前，两者之间可能会存在混淆。</div><div>       3. <span style="font-weight: bold;">模式匹配是一项命令行解析技术</span>，它可以轻松指定多个文件名，并且主要支持在命令行</div><div>          上表示文件名的模式。</div><div>       4. <span style="font-weight: bold;">正则表达式则设计为用文本字符串来表示任何形式或模式</span>，无论内容有多么复杂。</div><div>       5. 在内部，正则表达式受到大量文本处理命令（如grep、sed、awk、python、perl）和</div><div>          诸多应用程序的支持，在解释规则上存在与命令有关的细微差异。 </div><div><br/></div><div>     <img src="chapter1_files/Image [19].png" type="image/png" data-filename="Image.png" width="501"/></div><div>     <img src="chapter1_files/Image [20].png" type="image/png" data-filename="Image.png" width="501"/></div><div><br/></div><div><span style="font-weight: bold;">通过GREP匹配正则表达式：</span></div><ul><li><div><span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">grep</span>命令后跟一个正则表达式和一个文件。</div></li></ul><div>     <img src="chapter1_files/Image [21].png" type="image/png" data-filename="Image.png" width="577"/></div><div><br/></div><ul><li><div><span style="font-weight: bold;">由于正则表达式常含有shell元字符（如 $、* 和 {}），建议使用单引号括起正则表达式。</span></div></li><li><div>通过竖线运算符（<span style="font-weight: bold;">|</span>），grep命令可与其他命令一起使用。</div></li></ul><div>     <img src="chapter1_files/Image [22].png" type="image/png" data-filename="Image.png" width="578"/></div><div><br/></div><ul><li><div>grep选项：</div></li></ul><div>     <img src="chapter1_files/Image [23].png" type="image/png" data-filename="Image.png" width="500"/></div><div>     <img src="chapter1_files/Image [24].png" type="image/png" data-filename="Image.png" width="500"/></div><div><br/></div><ul><li><div>grep命令使用示例：</div></li></ul><div>     <img src="chapter1_files/Image [25].png" type="image/png" data-filename="Image.png" width="499"/></div><div>     <img src="chapter1_files/Image [26].png" type="image/png" data-filename="Image.png" width="499"/></div><div>     <img src="chapter1_files/Image [27].png" type="image/png" data-filename="Image.png" width="499"/></div><div>     <img src="chapter1_files/Image [28].png" type="image/png" data-filename="Image.png" width="499"/></div><div><br/></div><div>     <span style="color: rgb(250, 122, 0); font-weight: bold;">练习 P25：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">MATCHING TEXT IN COMMAND OUTPUT WITH REGULAR EXPRESSIONS</span></div><div><span style="color: rgb(250, 122, 0); font-weight: bold;">     Lab P28：IMPROVING COMMAND-LINE PRODUCTIVITY</span></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 