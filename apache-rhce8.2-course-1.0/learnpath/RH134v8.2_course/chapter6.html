<html>
<head>
  <title>第六章 管理基本存储</title>
  <basefont face="Consolas" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308816 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: Consolas;
      font-size: 11pt;
    }
  </style>
</head>
<body>
<a name="8796"/>

<div>
<span><div><div><div><div><div><div><span style="font-size: 12pt; color: rgb(0, 0, 255); font-weight: bold;">第六章 管理基本存储</span></div><div><br/></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>使用命令行创建和管理存储设备、分区、文件系统和交换空间。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">章节：</span></div><ul><li><div>添加分区、文件系统和持久挂载</div></li><li><div>管理交换空间</div></li></ul><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第一节：添加分区、文件系统和持久挂载</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能创建存储分区，将其格式化为相应的文件系统，然后进行挂载以供使用。</div></li></ul><div><br/></div></div><div><span style="font-weight: bold;">对磁盘进行分区：</span></div><ul><li><div>磁盘分区将硬盘驱动器划分为多个逻辑存储单元，这些单元称为分区（partitions）。</div></li><li><div>系统管理员可以使用不同的分区执行不同功能。</div></li></ul><div>    <span style="color: rgb(0, 0, 255); font-weight: bold;">* 注意：</span>物理服务器磁盘阵列分布示例</div><div>      <img src="chapter6_files/磁盘阵列参考.jpg" type="image/jpeg" data-filename="磁盘阵列参考.jpg" width="570"/>      </div><div><br/></div><div><span style="font-weight: bold;">MBR分区方案：MBR partitioning scheme</span></div><ul><li><div>诞生自1982年的<span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">MBR</span>（master boot record，主引导记录）分区方案在BIOS固件（firmware）</div></li></ul><div>     的系统上最多支持4个主分区（primary partition），通过扩展分区（extended partiton）</div><div>     和逻辑分区（logical partition），<span style="font-weight: bold;">最多创建 15 个分区</span>。</div><ul><li><div><span style="font-weight: bold;">由于分区大小数据以32位值存储，使用MBR分区方案时，最大磁盘和分区大小为 2TiB（单个分区</span></div></li></ul><div><span style="font-weight: bold;">     最大 2TiB）。</span></div><div>     <img src="chapter6_files/Image.png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><ul><li><div>由于物理磁盘变得越来越大，而基于SAN的卷甚至更大，因此针对MBR分区方案的2TiB磁盘和</div></li></ul><div>     分区大小限制已不再是理论限制，而是系统管理员在生产环境中越来越频繁遇到的实际问题。</div><ul><li><div>因此，新的<span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">GPT</span>（GUID partition table，GUID分区表）分区方案正在取代传统的MBR方案</div></li></ul><div>     用于磁盘分区。</div><div><br/></div><div><span style="font-weight: bold;">GPT分区方案：</span></div><ul><li><div>对于运行统一可扩展固件接口（unified extensible firmware interface，UEFI）固件的</div></li></ul><div>     系统，GPT是在物理硬盘上布置分区表的标准。</div><ul><li><div>GPT是UEFI标准的一部分，可以解决原有基于MBR的方案所带来的许多限制。</div></li></ul><div><br/></div><ul><li><div><span style="font-weight: bold;">GPT最多可提供128个分区。</span></div></li><li><div>MBR使用32位来存储逻辑块地址和大小信息，而GPT为逻辑块地址分配64位。</div></li><li><div><span style="font-weight: bold;">这使得GPT可支持最多 8ZiB，即 80 亿太字节的分区和磁盘。</span></div></li></ul><div><br/></div><ul><li><div>除解决MBR分区方案的限制以外，GPT还可提供一些其他功能特性和优势。</div></li><li><div>GPT使用全局唯一标识符（GUID）来识别每个磁盘和分区。</div></li><li><div>MBR存在单点故障，GPT提供分区表信息的冗余。</div></li><li><div><span style="font-weight: bold;">主GPT位于磁盘头部，而备份副本（次要GPT）位于磁盘尾部。</span></div></li><li><div>GPT使用校验和来检测GPT头和分区表中的错误与损坏。</div></li></ul><div>   <span style="color: rgb(0, 0, 255); font-weight: bold;">* 注意：</span></div><div>     1. 逻辑块地址：logical block address，LBA</div><div>     2. GPT分区方案中的LBA相当于MBR分区方案中的扇区</div><div>     3. <span style="font-weight: bold;">为兼容传统的MBR分区方案，GPT分区方案中使用受保护的MBR（protective MBR）。   </span></div><div><span style="font-weight: bold;">     </span><span style="font-weight: bold;"><img src="chapter6_files/Image [1].png" type="image/png" data-filename="Image.png" width="497"/></span></div><div><span style="font-weight: bold;">     </span><span style="font-weight: bold;"><img src="chapter6_files/GPT分区.jpg" type="image/jpeg" data-filename="GPT分区.jpg" width="274"/></span></div><div><br/></div><div>     <span style="color: rgb(0, 0, 255); font-weight: bold;">* 注意：</span></div><div>       1. 系统使用BIOS固件（Legacy模式）引导时，引导的系统盘只能使用MBR分区方式，</div><div>          数据存储的数据盘可使用MBR与GPT分区方式。</div><div>       2. 系统使用UEFI固件（UEFI模式）引导时，引导的系统盘默认使用GPT分区方式，数据</div><div>          存储的数据盘可使用MBR与GPT分区方式。  </div><div><br/></div><div><span style="font-weight: bold;">使用parted管理分区：</span></div><ul><li><div>parted工具可以管理 MBR 和 GPT 分区方案。</div></li><li><div>parted命令显示磁盘分区表，如下所示：</div></li></ul><div>     <img src="chapter6_files/Image [2].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><ul><li><div><span style="font-weight: bold;">默认情况下，parted单位是 10 进制（KB、MB、GB），可使用</span> <span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">unit</span> <span style="font-weight: bold;">子命令更改。</span></div></li></ul><div>     1. s 表示扇区</div><div>     2. B 表示字节</div><div>     3. MiB、GiB、TiB（2进制）</div><div>     4. MB、GB、TB（10进制）</div><div><br/></div><ul><li><div><span style="font-weight: bold;">$ parted /dev/sd</span><span style="font-style: italic; font-weight: bold;">X</span> <span style="font-weight: bold;">unit s print</span>：查看以扇区为单位的磁盘分区</div></li></ul><div>     <img src="chapter6_files/Image [3].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><div><span style="font-weight: bold;">向新磁盘写入分区表：</span></div><ul><li><div>对新磁盘进行分区，首先必须为其写入磁盘标签。</div></li><li><div><span style="font-weight: bold;">磁盘标签指示了所用的分区方案：MBR（msdos）、GTP（gpt）。</span></div></li></ul><div><br/></div><ul><li><div>创建新磁盘的磁盘标签：</div></li></ul><div>     $ parted /dev/sd<span style="font-style: italic;">X</span> mklabel msdos</div><div>     $ parted /dev/sd<span style="font-style: italic;">X</span> mklabel gpt</div><div>     <img src="chapter6_files/Image [4].png" type="image/png" data-filename="Image.png" width="498"/></div><div>     </div><div>     <span style="color: rgb(0, 0, 255); font-weight: bold;">* 注意：</span></div><div>       1. <span style="font-weight: bold;">parted命令更改立即生效。</span></div><div>       2. 如果误用了parted，注定会导致数据丢失。</div><div>       3. <span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">mklabel</span> 子命令可擦除现有的分区表。</div><div>       4. 仅当想重复使用磁盘而不考虑现有数据时，才应使用mklabel。</div><div>       5. 如果新标签更改了分区边界，则现有文件系统中的所有数据都将无法访问。</div><div><br/></div><div><span style="font-weight: bold;">创建MBR分区：</span></div><ul><li><div>指定需要创建分区的磁盘设备</div></li></ul><div>     <img src="chapter6_files/Image [5].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><ul><li><div>使用 <span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">mkpart</span> 子命令创建新的主分区或扩展分区</div></li><li><div>指定分区的文件系统类型，如xfs或ext4，这并不会在分区上创建文件系统，仅仅指示分区类型。</div></li></ul><div>     <img src="chapter6_files/Image [6].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><ul><li><div>指定新分区开始的扇区，s 后缀提供了扇区的值。</div></li><li><div>也可以使用 MiB、GiB、TiB、MB、GB 或 TB 后缀</div></li><li><div>如果未提供后缀，则默认为 MB。</div></li></ul></div><ul><li><div>指定应结束新分区的磁盘扇区</div></li></ul><div>     <img src="chapter6_files/Image [7].png" type="image/png" data-filename="Image.png" width="444"/></div><div><br/></div><div>     <span style="color: rgb(0, 0, 255); font-weight: bold;">* 注意：</span></div><div>       1. 当parted启动时，它将检索设备的磁盘拓扑。</div><div>       2. 如，磁盘的物理块大小通常是一个由parted收集的参数。</div><div>       3. <span style="font-weight: bold;">利用</span><span style="font-weight: bold;">这些信息，parted可确保所提供的起始位置能让分区与磁盘结构正确对齐。</span></div><div>       4. 正确的分区对齐对于获得最佳性能至关重要。</div><div>       5. 如果起始位置导致分区错位，parted会显示警告。</div><div>       6. <span style="font-weight: bold;">对于大多数磁盘而言，起始扇区为 2048 的倍数较为安全。 </span></div><div><br/></div><ul><li><div>通过parted并不能直接提供分区的大小，但可以使用以下公式进行快速计算：</div></li></ul><div>     <img src="chapter6_files/Image [8].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><ul><li><div>退出parted</div></li></ul><div>     <img src="chapter6_files/Image [9].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><ul><li><div><span style="font-weight: bold;">$ udevadm settle</span></div></li></ul><div>     # 等待系统检测新分区并在/dev目录下创建关联的设备文件</div><div>     </div><ul><li><div><span style="font-weight: bold;">$ parted /dev/sd</span><span style="font-style: italic; font-weight: bold;">X</span> <span style="font-weight: bold;">mkpart primary xfs 2048s 1000MB</span> </div></li></ul><div>     # parted命令行模式替代交互模式创建磁盘分区</div><div>     <img src="chapter6_files/Image [10].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><div><span style="font-weight: bold;">创建GPT分区：</span></div><ul><li><div>指定需要创建分区的磁盘设备</div></li><li><div>使用mkpart子命令开始创建新分区</div></li><li><div>指示要在分区上创建的文件系统类型，如xfs或ext4。</div></li><li><div>指定磁盘上新分区开始的扇区</div></li><li><div>指定应结束新分区的磁盘扇区</div></li><li><div>退出parted</div></li><li><div>运行udevadm settle命令，等待系统检测新分区并在/dev目录下创建关联的设备文件。</div></li></ul><div>     <img src="chapter6_files/Image [11].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><ul><li><div><span style="font-weight: bold;">$ parted /dev/sd</span><span style="font-style: italic; font-weight: bold;">X</span> <span style="font-weight: bold;">mkpart &lt;</span><span style="font-style: italic; font-weight: bold;">partition_name</span><span style="font-weight: bold;">&gt; &lt;</span><span style="font-style: italic; font-weight: bold;">fs</span><span style="font-weight: bold;">&gt; &lt;</span><span style="font-style: italic; font-weight: bold;">start</span><span style="font-weight: bold;">&gt; &lt;</span><span style="font-style: italic; font-weight: bold;">end</span><span style="font-weight: bold;">&gt;</span></div></li></ul><div>     # parted命令行模式替代交互模式创建磁盘分区</div><div>     <img src="chapter6_files/Image [12].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><div><span style="font-weight: bold;">删除分区：</span></div><ul><li><div>指定包含要删除的分区的磁盘</div></li><li><div>确定要删除的分区的分区编号</div></li><li><div>删除分区</div></li><li><div>退出parted</div></li></ul><div>     <img src="chapter6_files/Image [13].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><ul><li><div><span style="font-weight: bold;">$ parted /dev/sd</span><span style="font-style: italic; font-weight: bold;">X</span> <span style="font-weight: bold;">rm &lt;</span><span style="font-style: italic; font-weight: bold;">partition_number</span><span style="font-weight: bold;">&gt;</span>：命令行方式删除分区</div></li></ul><div><br/></div><div><span style="font-weight: bold;">创建文件系统：filesystem</span></div><ul><li><div>分区完成后，需要向其中添加文件系统（格式化过程）。</div></li><li><div><span style="font-weight: bold;">RHEL支持许多文件系统，其中两种常见的类型是 XFS 和 ext4。</span></div></li><li><div>RHEL安装程序 Anaconda 默认使用 XFS。</div></li><li><div>以root用户身份，使用 mkfs.xfs 命令为块设备应用XFS文件系统。</div></li><li><div>对于ext4文件系统，使用 mkfs.ext4 命令。</div></li></ul><div>     <img src="chapter6_files/Image [14].png" type="image/png" data-filename="Image.png" width="497"/></div><div>     <img src="chapter6_files/Image [15].png" type="image/png" data-filename="Image.png" width="497"/></div><div>    </div><div>   <span style="color: rgb(0, 0, 255); font-weight: bold;">* 注意：</span></div><div>     1. 由于RAID磁盘阵列卡故障而无法进行文件系统创建！</div><div>     <img src="chapter6_files/IMG_20180109_142247.jpg" type="image/jpeg" data-filename="IMG_20180109_142247.jpg" width="497"/></div><div><br/></div><div>     2. 每种文件系统需与块设备的容量大小相匹配，若块设备容量大于文件系统所能支持的容量，</div><div>        创建文件系统将报错！</div><div>     <img src="chapter6_files/Image [16].png" type="image/png" data-filename="Image.png" width="346"/>   </div><div>         </div><div><span style="font-weight: bold;">挂载文件系统：</span></div><ul><li><div>添加完文件系统后，最后一步是将文件系统挂载到目录结构中的目录上。</div></li><li><div>将文件系统挂载到目录层次结构上后，用户空间实用程序可以访问设备上的文件或在设备上</div></li></ul><div>     写入文件。</div><div><br/></div><div><span style="font-weight: bold;">手动挂载文件系统：</span></div><ul><li><div>如下所示：</div></li></ul><div>     <img src="chapter6_files/Image [17].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><div><span style="font-weight: bold;">持久挂载文件系统：</span></div><ul><li><div>手动挂载可用于验证，但是当系统重启，挂载将丢失。</div></li><li><div>为确保系统在启动时自动挂载文件系统，需要编辑<span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">/etc/fstab</span>文件。</div></li></ul><div>   <span style="color: rgb(0, 0, 255); font-weight: bold;">* 示例：</span>大数据平台节点/etc/fstab文件</div><div>     <img src="chapter6_files/fstab参数参考.jpg" type="image/jpeg" data-filename="fstab参数参考.jpg" width="497"/></div><div><br/></div><ul><li><div>在/etc/fstab文件中添加或删除条目后，需要运行 <span style="font-weight: bold;">systemctl daemon-reload</span> 命令或</div></li></ul><div>     重启服务器，让systemd注册新配置。</div><div><br/></div><ul><li><div>第一个字段：</div></li></ul><div>     1. 指定设备</div><div>     2. 示例使用 <span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">UUID</span> 来指定设备</div><div>     3. 创建时，文件系统会在其超级块中创建和存储UUID。</div><div>     4. 或可以使用设备文件，如/dev/vdb1。</div><div>     </div><div>     <span style="color: rgb(0, 0, 255); font-weight: bold;">* 注意：</span></div><div><span style="font-weight: bold;">    </span><span style="font-weight: bold;">   </span>1. <span style="font-weight: bold;">使用UUID更为可取，因为块设备标识符在特定情况下可能会变化。</span></div><div>       2. 如当云提供商更改虚拟机的基础存储层或在每次系统启动会以不同顺序检测磁盘时。</div><div>       3. <span style="font-weight: bold;">块设备文件名可能会发生改变，但UUID在文件系统的超级块中会保持不变。 </span></div><div><span style="font-weight: bold;">      </span> <span style="font-weight: bold;"><img src="chapter6_files/Image [18].png" type="image/png" data-filename="Image.png" width="482"/></span><span style="font-weight: bold;"> </span></div><div><span style="font-weight: bold;">   </span></div><ul><li><div>第二个字段：</div></li></ul><div>     1. 目录挂载点，通过它可以访问目录结构中的块设备。</div><div>     2. 挂载点必须存在，如果不存在，使用mkdir命令创建。</div><div><br/></div><ul><li><div>第三个字段：</div></li></ul><div>     文件系统类型，如xfs或ext4。</div><div><br/></div><ul><li><div>第四个字段：</div></li></ul><div>     1. 以逗号分隔的、应用于设备的选项列表。 </div><div>     2. defaults是一组常用选项。</div><div>        <span style="font-weight: bold;">$ man 8 mount</span>：查看挂载常用选项</div><div>        <img src="chapter6_files/Image [19].png" type="image/png" data-filename="Image.png" width="554"/></div><div><br/></div><ul><li><div>第五个字段：</div></li></ul><div>     1. <span style="font-weight: bold;">备份设备</span></div><div>     2. 其他备份应用通常不使用此字段，设置为 0。</div><div><br/></div><ul><li><div>最后一个字段：</div></li></ul><div>     1. <span style="font-weight: bold;">fsck顺序字段决定了在系统启动时是否应运行fsck命令，以验证文件系统是否干净。</span></div><div>     2. 该字段中的值表示fsck的运行顺序。</div><div>     3. <span style="color: rgb(0, 0, 255); font-weight: bold;">XFS文件系统不使用 fsck 来检查自己的文件系统状态，将该字段设为 0。</span></div><div>     4. ext4文件系统，若为根文件系统，将该字段设为 1。</div><div>     5. 若是其他ext4文件系统，则将该字段设为 2。</div><div>     6. <span style="font-weight: bold;">这样，fsck就会先处理根文件系统，然后同步检查不同磁盘上的文件系统，并按顺序</span></div><div><span style="font-weight: bold;">        检查同一磁盘上的文件系统。</span></div></div><div><br/></div><div>   <span style="color: rgb(0, 0, 255); font-weight: bold;">* 补充要点：</span></div><div>     1. 磁盘分区工具：parted、fdisk、gdisk</div><div>     2. 使用以上3种磁盘分区工具时，需注意各自使用的容量单位差异！</div><div>     <img src="chapter6_files/Image [20].png" type="image/png" data-filename="Image.png" width="497"/></div><div>     <img src="chapter6_files/Image [21].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><div>     3. <b>修复superblock损坏的ext4文件系统</b></div><div>     <img src="chapter6_files/Image [22].png" type="image/png" data-filename="Image.png" width="498"/></div><div>     <img src="chapter6_files/Image [23].png" type="image/png" data-filename="Image.png" width="498"/></div><div>     <img src="chapter6_files/Image [24].png" type="image/png" data-filename="Image.png" width="498"/></div><div>      </div><div>     <span style="color: rgb(250, 122, 0); font-weight: bold;">练习 P166：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">ADDING PARTITIONS, FILE SYSTEMS, AND PERSISTENT MOUNTS</span></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第二节：管理交换空间</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能够创建和管理交换空间以补充物理内存。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">交换空间概念简介：swap space</span></div><ul><li><div>交换空间（swap space）是受Linux内核内存管理子系统控制的磁盘区域。</div></li><li><div>内核使用交换空间，通过保存不活动的内存页（inactive pages）来补充系统RAM。</div></li><li><div><span style="font-weight: bold;">系统RAM与交换空间组合在一起称为虚拟内存（virtual memory）。</span></div></li></ul><div><br/></div><ul><li><div>当系统上的内存使用量超过定义的限制时，内核将搜索RAM，寻找已分配给进程但空闲的内存页。</div></li><li><div>内核将空闲的内存页写入到交换区，并向其他进程重新分配RAM页面。</div></li><li><div><span style="font-weight: bold;">如果某个程序需要访问磁盘上的页面，则内核会找到另一个空闲的内存页，将其写入到磁盘，</span></div></li></ul><div><span style="font-weight: bold;">     然后从交换区重新调用所需的页面。</span></div><div><br/></div><ul><li><div>由于交换区位于磁盘上，所以与RAM相⽐，交换会比较慢。</div></li><li><div>虽然是用于增加系统RAM，但对于RAM不足以满足工作负载需求的问题，不应将交换空间视为</div></li></ul><div>     可持续性的解决方案。</div><div><br/></div><div><span style="font-weight: bold;">调整交换空间的大小：</span></div><ul><li><div>如下所示：</div></li></ul><div>     <img src="chapter6_files/Image [25].png" type="image/png" data-filename="Image.png" width="499"/></div><div><br/></div><div><span style="font-weight: bold;">创建SWAP分区：</span></div><ul><li><div>使用parted可以创建所需大小的分区并将其文件系统类型设置为 linux-swap。</div></li><li><div><span style="font-weight: bold;">$ parted /dev/sd</span><span style="font-style: italic; font-weight: bold;">X</span> <span style="font-weight: bold;">mkpart &lt;</span><span style="font-style: italic; font-weight: bold;">partition_name</span><span style="font-weight: bold;">&gt; linux-swap &lt;</span><span style="font-style: italic; font-weight: bold;">start</span><span style="font-weight: bold;">&gt; &lt;</span><span style="font-style: italic; font-weight: bold;">end</span><span style="font-weight: bold;">&gt;</span></div></li></ul><div>     # 命令行方式创建SWAP分区</div><ul><li><div>$ udevamd settle</div></li></ul><div>     # 等待系统检测新分区并在/dev目录下创建关联的设备文件</div><div>     <img src="chapter6_files/Image [26].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><div><span style="font-weight: bold;">格式化SWAP分区：</span></div><ul><li><div><span style="color: rgb(0, 0, 255); font-style: italic; font-weight: bold;">mkswap</span> 命令格式化SWAP分区，mkswap在分区开头写入单个数据块，而将分区的其余部分保留</div></li></ul><div>     为未格式化，这样内核就可以使用它来存储内存页。</div><div>     <img src="chapter6_files/Image [27].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><div><span style="font-weight: bold;">激活SWAP分区：</span></div><ul><li><div>swapon 命令激活已格式化的SWAP分区。</div></li><li><div><span style="font-weight: bold;">$ swapon -a</span>：激活/etc/fstab文件中列出的所有SWAP分区</div></li><li><div><span style="font-weight: bold;">$ swapon --show</span>：查看可用的SWAP分区及其优先级</div></li><li><div>swapoff 命令停用SWAP分区。</div></li><li><div>如果交换空间具有写入的页面，swapoff会尝试将这些页面移动到其他活动交换空间或将</div></li></ul><div>     其写回到内存中。</div><ul><li><div>如果无法将数据写入到其他位置，则swapoff命令会失败，并显示错误，而交换空间将仍</div></li></ul><div>     保持活动。</div><div>     <img src="chapter6_files/Image [28].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><div><span style="font-weight: bold;">永久激活SWAP分区：</span></div><ul><li><div>编辑/etc/fstab文件，如下所示写入相应条目：</div></li></ul><div>     <img src="chapter6_files/Image [29].png" type="image/png" data-filename="Image.png" width="577"/></div><ul><li><div>$ systemctl daemon-reload：使systemd服务注册新配置</div></li></ul></div><div><br/></div><div><span style="font-weight: bold;">设置SWAP分区优先级：priority</span></div><ul><li><div>默认情况下，系统会按顺序使用交换空间，即内核先使用第一个已激活交换空间，直至其</div></li></ul><div>     空间已满，然后开始使用第二个交换空间。</div><ul><li><div>可以为每个交换空间定义优先级，从而强制按该顺序使用交换空间。</div></li><li><div><span style="font-weight: bold;">要设置优先级，可在/etc/fstab中使用</span> <span style="font-weight: bold; font-style: italic; color: rgb(0, 0, 255);">pri</span> <span style="font-weight: bold;">选项。</span></div></li><li><div>内核会首先使用优先级最高的交换空间。</div></li><li><div><span style="font-weight: bold;">默认优先级为 -2，值越高，优先级越高。</span></div></li></ul><div><br/></div><ul><li><div>如下所示，/etc/fstab中定义的三个交换空间。</div></li><li><div>内核首先使用最后一个条目，其优先级为 pri=10。</div></li><li><div>当该空间已满时，它将使用第二个条目，其优先级为 pri=4。</div></li><li><div>最后，它将使用第一个条⽬，其默认优先级为 -2。</div></li></ul><div>     <img src="chapter6_files/Image [30].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><ul><li><div><span style="font-weight: bold;">当SWAP分区具有相同的优先级时，内核会以轮循方式向其中写入。</span></div></li></ul><div><br/></div><div>     <span style="color: rgb(250, 122, 0); font-weight: bold;">练习 P174：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">MANAGING SWAP SPACE</span></div><div><span style="color: rgb(250, 122, 0); font-weight: bold;">     Lab P178：MANAGING BASIC STORAGE</span></div><div><br/></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 