<html>
<head>
  <title>第七章 控制对文件的访问</title>
  <basefont face="Consolas" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308816 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: Consolas;
      font-size: 11pt;
    }
  </style>
</head>
<body>
<a name="2998"/>

<div>
<span><div><div><div><div><font style="font-size: 12pt;"><span style="font-size: 12pt; color: rgb(0, 0, 255); font-weight: bold;">第七章 控制对文件的访问</span></font></div><div><font style="font-size: 12pt;"><span style="font-size: 12pt;"><br/></span></font></div><div><font style="font-size: 11pt;"><span style="font-size: 11pt; font-weight: bold;">目标：</span></font></div><ul><li><div>设置文件的Linux文件系统权限，并解释不同权限设置的安全效果。<span style="font-size: 11pt;"> </span></div></li></ul><div><br/></div></div><div><span style="font-weight: bold;">章节：</span></div><ul><li><div>解释Linux文件系统权限</div></li><li><div>从命令行管理文件系统权限</div></li><li><div>管理默认权限与文件访问</div></li></ul><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第一节：解释Linux文件系统权限</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能列出文件或目录的文件系统权限，并解释这些权限</div></li></ul><div>     对用户和组访问的影响。</div><div><br/></div><div><span style="font-weight: bold;">Linux文件系统权限：</span></div><ul><li><div>文件权限控制对文件的访问。</div></li><li><div>Linux可以针对文件所属用户、所属组和其他用户设置不同的权限。</div></li><li><div>权限具有优先级，user权限覆盖group权限，后者覆盖other权限。</div></li><li><div><span style="font-weight: bold;">三种权限类别：读取（r）、写入（w）、执行（x）。</span></div></li></ul><div>     <img src="chapter7_files/Image.png" type="image/png" data-filename="Image.png" width="500"/></div><div>     </div></div><ul><li><div>用户通常对目录具有r和x权限，可以进入目录并列出文件。</div></li><li><div>如果对目录只有r权限，则只能列出目录中文件名称，无法获得属性。</div></li><li><div><span style="font-weight: bold;">对于文件所在的目录，拥有其所有权或写入权限的任何用户都可以删除此文件，不论此</span></div></li></ul><div><span style="font-weight: bold;">     文件本身的所有权</span><span style="font-weight: bold;">或权限如何（包括root用户创建的文件）。</span></div><div><span style="font-weight: bold;">     </span><span style="font-weight: bold;"><img src="chapter7_files/Image [1].png" type="image/png" data-filename="Image.png" width="497"/></span></div><div>   <span style="color: rgb(0, 0, 255); font-weight: bold;">* 注意：</span>子目录的权限取决于父目录权限，若父目录对于用户无可读权限，子目录即使可读也无法访问。</div><div>     </div><div><span style="font-weight: bold;">查看文件与目录权限与所有权：</span></div><ul><li><div>ls -l命令显示文件的权限和所有权，-d选项显示所属目录的权限和所有权信息。</div></li></ul><div>     <img src="chapter7_files/Image [2].png" type="image/png" data-filename="Image.png" width="501"/></div><div>     <img src="chapter7_files/Image [3].png" type="image/png" data-filename="Image.png" width="499"/></div><div><br/></div><ul><li><div>第一位：文件类型</div></li></ul><div>      - ：普通文件</div><div>      d：目录</div><div>      l：软链接</div><div>      b：块设备</div><div>      c：字符设备（鼠标或键盘）</div><div>      s：socket文件</div><ul><li><div>后九位：文件权限</div></li></ul><div>     1. 分三组，每组三个字符。</div><div>     2. 每组分别对应所属用户、所属组、其他用户权限。</div><div>     3. 权限表示为：r、w、x、-。</div><ul><li><div>第十位（. <span style="font-style: italic;">or</span> +）：SELinux标签是否启用、ACL是否启用。</div></li></ul><div>     <img src="chapter7_files/ls输出列解释.jpg" type="image/jpeg" data-filename="ls输出列解释.jpg" width="406"/></div><div><br/></div><div>     <span style="color: rgb(250, 122, 0); font-weight: bold;">练习 P211：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">INTERPRETING LINUX FILE SYSTEM PERMISSIONS</span></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第二节：从命令行管理文件系统权限</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能使用命令行工具更改文件的权限与所有权。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">更改文件与目录的权限：</span></div><ul><li><div>chmod（change mode）命令用于修改文件权限，可使用符号法或数值法来设置权限。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">使用符号法更改权限：symbolic method</span></div><ul><li><div>命令语法如下所示：</div></li></ul><div>     <img src="chapter7_files/Image [4].png" type="image/png" data-filename="Image.png" width="498"/></div><div>     1. Who：u、g、o、a（代表用户、组、其他、全部用户）</div><div>     2. What：+、-、=（代表添加、删除、精确设置）</div><div>     3. Which：r、w、x或X（代表读取、写入、执行）</div><div><br/></div><ul><li><div>对目录设置执行权限需使用大写的X</div></li><li><div><span style="color: rgb(0, 0, 255); font-weight: bold;">仅当为目录或者已为用户、组或其他用户设置了执行权限时，使用大写的X作为添加执行权限。</span></div></li><li><div>若使用小写的x，将为所有文件或目录添加执行权限。</div></li></ul><div>     <img src="chapter7_files/Image [5].png" type="image/png" data-filename="Image.png" width="495"/></div><div><br/></div><div><span style="font-weight: bold;">使用数值法更改权限：numeric method</span></div><ul><li><div>命令语法如下所示：###代表每一位数字</div></li></ul><div>     <img src="chapter7_files/Image [6].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><ul><li><div>每个数字代表一个访问级别的权限：user、group、other。</div></li><li><div><span style="font-weight: bold;">数字的计算方法：将每个权限的数值加在一起，其中4代表读取，2代表写入，1代表执行。</span></div></li><li><div>数值法中的每个数字是一个八进制位（octal bit）。</div></li><li><div>有经验的管理员通常使用数值权限，因为它们的输入比较短，而仍能完全控制所有权限。</div></li></ul><div>     <img src="chapter7_files/Image [7].png" type="image/png" data-filename="Image.png" width="499"/></div><div>     <img src="chapter7_files/Image [8].png" type="image/png" data-filename="Image.png" width="499"/></div><div><br/></div><div><span style="font-weight: bold;">更改文件与目录的用户或组所有权：</span></div><ul><li><div>新文件由创建该文件的用户所有。</div></li><li><div>只有root用户可以更改拥有文件的用户，组所有权可以由root用户或文件的所有者来设置。</div></li><li><div>root用户可将文件所有权授予任何组，而普通用户仅可将文件所有权授予他们所属的组。</div></li></ul><div><br/></div><ul><li><div>使用chown（change owner）命令可更改文件所有权，-R选项递归更改。</div></li></ul><div>     <img src="chapter7_files/Image [9].png" type="image/png" data-filename="Image.png" width="498"/></div><div>     <img src="chapter7_files/Image [10].png" type="image/png" data-filename="Image.png" width="498"/></div><div>     <img src="chapter7_files/Image [11].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><ul><li><div>使用冒号（:）分隔用户名与组名</div></li></ul><div>     <img src="chapter7_files/Image [12].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><ul><li><div>$ chgrp &lt;<span style="font-style: italic;">groupname</span>&gt; &lt;<span style="font-style: italic;">filename</span>&gt;：更改文件的所有组</div></li></ul><div><br/></div><div><span style="color: rgb(0, 0, 255); font-weight: bold;">   * 注意：</span></div><div>     1. 也可使用句号（.）分隔用户名与组名，如下所示：</div><div>        <img src="chapter7_files/Image [13].png" type="image/png" data-filename="Image.png" width="475"/></div><div>     2.<span style="font-weight: bold;"> 但不推荐使用</span>，原因如下：</div><div>     3. 由于在用户名中可以使用句号（.），如系统中存在enoch.root用户、enoch用户与</div><div>        root组，本意是更改文件的所有者为enoch用户，但使用该语法后文件的所有者更改</div><div>        为enoch.root用户，给权限管理造成困扰。</div><div><br/></div><div>     <span style="color: rgb(250, 122, 0); font-weight: bold;">练习 P219：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">MANAGING FILE SYSTEM PERMISSIONS FROM THE COMMAND LINE</span></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第三节：管理默认权限与文件访问</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能：</div></li><li><div>  控制由用户创建的新文件的用户权限</div></li><li><div>  解释特殊权限的影响</div></li><li><div>  使用特殊权限和默认权限设置在特定目录中创建的文件的组所有者</div></li></ul><div><br/></div><div><span style="font-weight: bold;">特殊权限：</span></div><ul><li><div>特殊权限构成了除了基本用户、组和其他类型之外的第四种权限类型。</div></li><li><div>顾名思义，这些权限提供了额外的访问相关功能，超出了基本权限类型允许的范畴。</div></li><li><div><span style="font-weight: bold;">sticky bit（sbit）：粘滞位</span></div></li></ul><div>     <img src="chapter7_files/Image [14].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><ul><li><div>特殊权限示例：</div></li></ul><div>     1. suid与sgid对文件的影响：</div><div>        $ ls -l /usr/bin | egrep &quot;wsr|-sr|ws-|-s-&quot;：查看相关的suid与sgid文件</div><div>        <img src="chapter7_files/Image [15].png" type="image/png" data-filename="Image.png" width="475"/></div><div>     </div><div>     2. sgid对目录中创建的文件的影响：<b><font style="color: rgb(0, 0, 255);">所有组继承</font> </b></div><div>        <img src="chapter7_files/Image [16].png" type="image/png" data-filename="Image.png" width="475"/></div><div>     </div><div>     3. 粘滞位示例：</div><div>        a. 具有粘滞位权限的目录中只有文件的所有者才能删除文件！</div><div>        <img src="chapter7_files/Image [17].png" type="image/png" data-filename="Image.png" width="474"/></div><div><br/></div><div>        b. 不具有粘滞位权限的目录其他用户可删除另一用户的文件 </div><div>        <img src="chapter7_files/Image [18].png" type="image/png" data-filename="Image.png" width="474"/></div><div><br/></div><div>        c. <span style="font-weight: bold;">区别：粘滞位权限报错不同于普通权限报错</span></div><div>        <img src="chapter7_files/Image [19].png" type="image/png" data-filename="Image.png" width="474"/></div><div>     </div><div><span style="font-weight: bold;">设置特殊权限：</span></div><ul><li><div>用符号法表示：setuid = <span style="font-weight: bold;">u+s</span>、setgid = <span style="font-weight: bold;">g+s</span>、sticky = <span style="font-weight: bold;">o+t</span></div></li><li><div>用数值法表示（第四位）：setuid = 4、setgid = 2、sticky = 1</div></li></ul><div>     <img src="chapter7_files/Image [20].png" type="image/png" data-filename="Image.png" width="499"/></div><div>     <img src="chapter7_files/Image [21].png" type="image/png" data-filename="Image.png" width="499"/></div><div><br/></div><div><span style="font-weight: bold;">默认文件权限：</span></div><ul><li><div>创建新文件或目录时，会为其分配初始权限。</div></li><li><div>影响初始权限的两个因素：</div></li></ul><div>     1. 首先是创建常规文件还是目录</div><div>        a. 创建新目录：操作系统会为其分配权限 0777（drwxrwxrwx）。</div><div>        b. 创建新文件：操作系统则为其分配权限 0666（-rw-rw-rw-）。</div><div>     2. 其次是当前用户的umask</div><div>        a. shell会话根据当前用户设置一个umask，进一步限制初始设置的权限。</div><div>        b. <span style="font-weight: bold;">umask值是一个八进制位掩码，用于清除由该进程创建的新文件和目录的权限。</span></div><div>        c. 如，umask 0002 可清除其他用户的写入位。</div><div>           计算方法：创建文件 0666（0 0110 0110 <span style="font-weight: bold;">0110</span>），umask 0002（0 0000 0000 <span style="font-weight: bold;">0010</span>），</div><div>           两者相减得 0664（0 0110 0110 <span style="font-weight: bold;">0100</span>），即文件的默认权限为 -rw-rw-r--。</div><div>        d. 前导零表示特殊的用户和组权限未被清除</div><div><br/></div><ul><li><div>默认umask掩码值：<span style="font-weight: bold;">002</span>（UID &gt;= 200）、<span style="font-weight: bold;">022</span>（0 &lt;= UID &lt;= 199）</div></li><li><div>可根据需要自定义调整umask值：</div></li></ul><div>     1. 命令行方式调整umask值：</div><div>        <img src="chapter7_files/Image [22].png" type="image/png" data-filename="Image.png" width="474"/></div><div>        <img src="chapter7_files/Image [23].png" type="image/png" data-filename="Image.png" width="474"/></div><div>        <img src="chapter7_files/Image [24].png" type="image/png" data-filename="Image.png" width="475"/></div><div>        <img src="chapter7_files/Image [25].png" type="image/png" data-filename="Image.png" width="475"/></div><div><br/></div><div>     2. 通过配置文件调整umask值：<span style="font-weight: bold;">/etc/profile.d/*</span>（推荐！）</div><div>        <img src="chapter7_files/Image [26].png" type="image/png" data-filename="Image.png" width="476"/></div><div><br/></div><div>     <span style="color: rgb(250, 122, 0); font-weight: bold;">练习 P227：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">MANAGING DEFAULT PERMISSIONS AND FILE ACCESS</span></div></div><div><span style="font-weight: bold; color: rgb(250, 122, 0);">     Lab P232：CONTROLLING ACCESS TO FILES</span></div><div><br/></div><div><br/></div></span>
</div></body></html> 