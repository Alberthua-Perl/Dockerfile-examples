<html>
<head>
  <title>第十三章 归档与传输文件</title>
  <basefont face="Consolas" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308816 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: Consolas;
      font-size: 11pt;
    }
  </style>
</head>
<body>
<a name="3752"/>

<div>
<span><div><div><div><div><span style="font-size: 12pt; color: rgb(0, 0, 255); font-weight: bold;">第十三章 归档与传输文件</span></div><div><br/></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>将文件归档，并将文件从一个系统复制到另一个系统。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">章节：</span></div><ul><li><div>管理压缩的tar归档</div></li><li><div>在系统间安全地传输文件</div></li><li><div>在系统间安全地同步文件</div></li></ul><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第一节：管理压缩的tar归档</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能使用tar将文件和目录归档到压缩文件中，还能提取现有</div></li></ul><div>     tar存档的内容。</div><div><br/></div><div><span style="font-weight: bold;">tar命令：</span></div><ul><li><div>创建备份和通过网络传输数据时，归档和压缩文件非常有用，最常用的命令是tar。</div></li><li><div>tar命令支持文件归档和gzip、bzip2或xz的压缩与解压缩。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">所选的tar选项：</span></div><ul><li><div>选项如下所示：</div></li></ul><div>     <img src="chapter13_files/Image.png" type="image/png" data-filename="Image.png" width="501"/></div><div>     <img src="chapter13_files/Image [1].png" type="image/png" data-filename="Image.png" width="502"/></div></div><div><br/></div><div><span style="font-weight: bold;">列出tar命令选项：</span></div><ul><li><div>tar命令需要以下三个选项之一：</div></li></ul><div>     1. -c 或 --create 选项：创建归档</div><div>     2. -t 或 --list 选项：列出归档的内容</div><div>     3. -x 或 --extract 选项：提取归档</div><div>     4. -f 或 --file= 选项：指定归档的文件名</div><div>     5. -v 或 --verbose 选项：查看添加到归档中或从中提取的文件信息</div><div><br/></div><ul><li><div><span style="font-weight: bold;">tar命令可使用忽略&quot;-&quot;的选项，或带有&quot;-&quot;的选项。</span></div></li></ul><div><br/></div><div><span style="font-weight: bold;">归档文件与目录：</span></div><ul><li><div>$ tar -cf &lt;<span style="font-style: italic;">archive_name</span>&gt;.tar &lt;<span style="font-style: italic;">filename1</span>&gt; ... &lt;<span style="font-style: italic;">filename</span><span style="font-style: italic; font-weight: bold;">N</span>&gt;：将多个文件归档</div></li><li><div>$ tar -cf &lt;<span style="font-style: italic;">archive_name</span>&gt;.tar /<span style="font-style: italic;">path</span>/<span style="font-style: italic;">of</span>/<span style="font-style: italic;">directory</span>：将目录归档</div></li><li><div><span style="font-weight: bold;">$ tar -rf &lt;</span><span style="font-style: italic; font-weight: bold;">archive_name</span><span style="font-weight: bold;">&gt;.tar &lt;</span><span style="font-style: italic; font-weight: bold;">filename</span><span style="font-weight: bold;">&gt;</span>：追加文件至归档中</div></li></ul><div>     <img src="chapter13_files/Image [2].png" type="image/png" data-filename="Image.png" width="499"/></div><div>     <img src="chapter13_files/Image [3].png" type="image/png" data-filename="Image.png" width="498"/></div><div>     <img src="chapter13_files/Image [4].png" type="image/png" data-filename="Image.png" width="499"/></div><div><br/></div><div>   <span style="color: rgb(0, 0, 255); font-weight: bold;">* 注意：</span></div><div>     1. tar命令在当前工作目录中覆盖已存在的归档没有任何警告信息。</div><div>     2. <span style="font-weight: bold;">使用</span><span style="font-weight: bold;">绝对路径名归档文件时，将默认从文件名中删除该路径中的前面的 / 符号。</span></div><div>        删除路径中的前导 / 可帮助用户在提取存档时避免覆盖重要文件。 </div><div>        tar命令相对于当前的工作目录提取文件。</div><div>        <img src="chapter13_files/Image [5].png" type="image/png" data-filename="Image.png" width="474"/></div><div>     3. <b>部分高级权限如ACLs和SELinux上下文不会自动存储到tar归档中。</b></div><div>        <img src="chapter13_files/Image [6].png" type="image/png" data-filename="Image.png" width="475"/></div><div>     4. 可使用 <span style="font-weight: bold;"><i><font style="color: rgb(250, 122, 0);">--xattrs</font></i> </span>选项指定扩展属性。</div><div><br/></div><div><span style="font-weight: bold;">列出归档的内容：</span></div></div><ul><li><div><span style="font-weight: bold;">$ tar -tf &lt;</span><span style="font-style: italic; font-weight: bold;">archive_name</span><span style="font-weight: bold;">&gt;.tar</span>：列出归档文件的内容</div></li></ul><div>     <img src="chapter13_files/Image [7].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><div><span style="font-weight: bold;">从归档中提取文件：</span></div><ul><li><div>当root提取归档时，tar命令会保留文件的原始用户和组所有权。</div></li><li><div>如果普通用户使用tar命令提取文件，文件所有权将属于从归档中提取文件的用户。</div></li></ul><div><span style="font-weight: bold;">     </span><span style="font-weight: bold;"><img src="chapter13_files/Image [8].png" type="image/png" data-filename="Image.png" width="497"/></span></div><div><br/></div><div><span style="font-weight: bold;">创建压缩归档：</span></div><ul><li><div><span style="font-weight: bold;">压缩比率：xz</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-weight: bold;">&gt;</span> <span style="font-weight: bold;">bzip2</span> <span style="font-family: &quot;DejaVu Sans Mono&quot;; font-weight: bold;">&gt;</span> <span style="font-weight: bold;">gzip</span></div></li><li><div>tar命令支持三种压缩方式。</div></li><li><div>gzip压缩速度最快，历史最久，使用也最为广泛，能够跨发行版，甚至跨平台使用。</div></li><li><div>bzip2压缩创建的归档文件通常比gzip创建的文件小，但可用性不如gzip广泛。</div></li><li><div>xz压缩方式相对较新，通常提供最佳的压缩率。</div></li><li><div>使用下列选项之一来创建压缩的tar归档:</div></li></ul><div>     1. -z 或 --gzip：gzip压缩（文件后缀 <span style="font-weight: bold;">.tar.gz</span> 或 <span style="font-weight: bold;">.tgz</span>）</div><div>     2. -j 或 --bzip2：bzip2压缩（文件后缀 <span style="font-weight: bold;">.tar.bz2</span>）</div><div>     3. -J 或 -xz：xz压缩（文件后缀 <span style="font-weight: bold;">.tar.xz</span>）</div><div><br/></div><ul><li><div>$ tar -zcf &lt;<span style="font-style: italic;">archive_compressed_name</span>&gt;.tar.gz /<span style="font-style: italic;">path</span>/<span style="font-style: italic;">of</span>/<span style="font-style: italic;">directory</span></div></li><div># 创建gzip压缩的归档文件</div></ul><div>     <img src="chapter13_files/Image [9].png" type="image/png" data-filename="Image.png" width="499"/></div><div><br/></div><ul><li><div>$ tar -jcf &lt;<span style="font-style: italic;">archive_compressed_name</span>&gt;.tar.bz2 /<span style="font-style: italic;">path</span>/<span style="font-style: italic;">of</span>/<span style="font-style: italic;">directory</span></div></li></ul><div><span style="font-style: italic;">     </span># 创建bzip2压缩的归档文件</div><div>     <img src="chapter13_files/Image [10].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><ul><li><div>$ tar -Jcf &lt;<span style="font-style: italic;">archive_compressed_name</span>&gt;.tar.xz /<span style="font-style: italic;">path</span>/<span style="font-style: italic;">of</span>/<span style="font-style: italic;">directory</span></div></li></ul><div><span style="font-style: italic;">     </span># 创建xz压缩的归档文件</div><div>     <img src="chapter13_files/Image [11].png" type="image/png" data-filename="Image.png" width="498"/>     </div><div><br/></div><ul><li><div><span style="font-weight: bold;">$ tar -tf &lt;</span><span style="font-style: italic; font-weight: bold;">archive_compressed_name</span><span style="font-weight: bold;">&gt;.tar.gz</span>：查看压缩的归档文件中文件信息</div></li></ul><div><br/></div><div>  <span style="color: rgb(0, 0, 255); font-weight: bold;"> * 注意：</span></div><div>      $ gzip &lt;<span style="font-style: italic;">archive_name</span>&gt;.tar</div><div>      $ bzip2 &lt;<span style="font-style: italic;">archive_name</span>&gt;.tar</div><div>      $ xz &lt;<span style="font-style: italic;">archive_name</span>&gt;.tar</div><div><br/></div><div>      $ gunzip &lt;<span style="font-style: italic;">archive_compressed_name</span>&gt;.tar.gz</div><div>      $ bunzip2 &lt;<span style="font-style: italic;">archive_compressed_name</span>&gt;.tar.bz2</div><div>      $ unxz &lt;<span style="font-style: italic;">archive_compressed_name</span>&gt;.tar.xz </div><div><br/></div><div><span style="font-weight: bold;">提取压缩的归档：</span></div><ul><li><div>$ tar -zxf &lt;<span style="font-style: italic;">archive_compressed_name</span>&gt;.tar.gz：解压gzip归档文件至当前目录中</div></li><li><div>$ tar -jxf &lt;<span style="font-style: italic;">archive_compressed_name</span>&gt;.tar.bz2：解压bzip2归档文件至当前目录中</div></li><li><div>$ tar -Jxf &lt;<span style="font-style: italic;">archive_compressed_name</span>&gt;.tar.xz：解压xz归档文件至当前目录中</div></li></ul><div><br/></div><ul><li><div><span style="font-weight: bold;">$ tar -zxvf &lt;</span><span style="font-style: italic; font-weight: bold;">archive_compressed_name</span><span style="font-weight: bold;">&gt;.tar.gz -C /</span><span style="font-style: italic; font-weight: bold;">path</span><span style="font-weight: bold;">/</span><span style="font-style: italic; font-weight: bold;">of</span><span style="font-weight: bold;">/</span><span style="font-style: italic; font-weight: bold;">destination</span><span style="font-weight: bold;">/</span><span style="font-style: italic; font-weight: bold;">directory</span></div></li></ul><div>     # 解压gzip归档文件至目标目录中</div><div><br/></div><div>   <span style="color: rgb(0, 0, 255); font-weight: bold;">* 注意：</span></div><div>     1. 不同版本的Linux发行版中解压归档文件使用的tar命令可能存在差异而报错！</div><div>     2. RHEL 7与SLES 12 SP3之间的解压归档文件将出现报错。</div><div><br/></div><div>     <span style="color: rgb(250, 122, 0); font-weight: bold;">练习 P454：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">MANAGING COMPRESSED TAR ARCHIVES</span></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第二节：在系统间安全地传输文件</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能通过SSH与远程系统安全地来回传输文件。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">使用SECURE COPY拷贝文件：</span></div><ul><li><div>Secure Copy命令scp是OpenSSH套件（openssh-clients）的一部分，可将文件从</div></li></ul><div>     远程系统复制到本地系统或从本地系统复制到远程系统。</div><ul><li><div>此命令利用SSH服务器进行身份验证，并在数据传输之前对其进行加密。</div></li><li><div>本地与远程服务器之间传输文件：</div></li></ul><div>     <img src="chapter13_files/Image [12].png" type="image/png" data-filename="Image.png" width="497"/></div><div>     <img src="chapter13_files/Image [13].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><ul><li><div><span style="font-weight: bold;">scp命令传输目录使用 -r 选项：</span></div></li></ul><div>     <img src="chapter13_files/Image [14].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><div><span style="font-weight: bold;">使用安全文件传输程序传输文件：</span></div><ul><li><div>sftp类似于FTP软件的操作，但是传输基于SSH身份验证和加密，保证传输安全。</div></li></ul><div>     <img src="chapter13_files/Image [15].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><ul><li><div>完成连接后，可以使用ls、cd、mkdir、rmdir、pwd、put、get命令控制文件系统。</div></li><li><div>exit命令退出sftp会话。</div></li></ul><div>     <img src="chapter13_files/Image [16].png" type="image/png" data-filename="Image.png" width="500"/></div><div>     <img src="chapter13_files/Image [17].png" type="image/png" data-filename="Image.png" width="502"/></div><div><br/></div><div><span style="color: rgb(0, 0, 255); font-weight: bold;">   * 注意：</span></div><div>     1. sftp服务为SSH服务子系统，且默认开启。</div><div>     <img src="chapter13_files/Image [18].png" type="image/png" data-filename="Image.png" width="502"/></div><div>     2. 在sftp会话中获取帮助：</div><div>     <img src="chapter13_files/Image [19].png" type="image/png" data-filename="Image.png" width="496"/></div><div><br/></div><div>    <span style="color: rgb(250, 122, 0); font-weight: bold;"> 练习 P459：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">TRANSFERRING FILES BETWEEN SYSTEMS SECURELY</span></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第三节：在系统间安全地同步文件</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能高效而安全地将本地文件或目录的内容与远程服务器上的副本进行同步。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">使用rsync同步文件与目录：</span></div><ul><li><div>rsync命令是在系统之间安全复制文件的另一种方式。</div></li><li><div>此工具采用的算法可通过仅同步已更改的文件部分来将复制的数据量最小化。</div></li><li><div><span style="font-weight: bold;">rsync命令将仅复制文件系统间的差异部分（增量备份），而scp命令复制所有内容（全量备份）。</span></div></li><li><div>rsync命令的重要选项:</div></li></ul><div>       -n, --dry-run       干运行（模拟运行），显示需要同步的文件清单，而不是真正同步。</div><div>       <span style="font-weight: bold;">-v, --verbose</span>       查看命令运行详细信息    </div><div>       <span style="font-weight: bold;">-a, --archive</span>       归档模式，相当于 -rlptgoD（不包括-H、-A、-X）。</div><div>       -H, --hard-links    保留文件硬链接</div><div>       -A, --acls          保留ACLs（高级权限）</div><div>       -X, --xattrs        保留SELinux上下文</div><div><br/></div><div>     <img src="chapter13_files/Image [20].png" type="image/png" data-filename="Image.png" width="499"/></div><div>     <img src="chapter13_files/Image [21].png" type="image/png" data-filename="Image.png" width="499"/>     </div><div><br/></div><ul><li><div>rsync命令可同步本地系统的文件或目录。</div></li></ul><div>     <img src="chapter13_files/Image [22].png" type="image/png" data-filename="Image.png" width="497"/></div><div><br/></div><ul><li><div>使用rsync命令同步远程系统上的文件或目录。</div></li></ul><div>     <img src="chapter13_files/Image [23].png" type="image/png" data-filename="Image.png" width="499"/></div><div>     <img src="chapter13_files/Image [24].png" type="image/png" data-filename="Image.png" width="499"/></div><div><br/></div><div><span style="color: rgb(0, 0, 255); font-weight: bold;">   * 注意：</span></div><div>     1. <span style="font-weight: bold;">为rsync命令输入源目录时，目录名称中是否存在尾随斜杠至关重要。</span></div><div><span style="font-weight: bold;">        它将决定同步到目标中的是目录还是仅目录中的内容。</span></div><div>     2. Tab补全可自动在目录名称中添加尾随斜杠。</div></div><div><br/></div><div>     <span style="color: rgb(250, 122, 0); font-weight: bold;">练习 P465：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">SYNCHRONIZING FILES BETWEEN SYSTEMS SECURELY</span></div><div><span style="color: rgb(250, 122, 0); font-weight: bold;">     Lab P467：ARCHIVING AND TRANSFERRING FILES</span></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 