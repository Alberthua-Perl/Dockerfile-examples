<html>
<head>
  <title>第十二章 管理网络</title>
  <basefont face="Consolas" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/308816 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <style>
    body, td {
      font-family: Consolas;
      font-size: 11pt;
    }
  </style>
</head>
<body>
<a name="3492"/>

<div>
<span><div><div><div><div><div><div><span style="font-size: 12pt; color: rgb(0, 0, 255); font-weight: bold;">第十二章 管理网络</span></div><div><br/></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>配置RHEL服务器上的网络接口和设置</div></li></ul><div><br/></div><div><span style="font-weight: bold;">章节：</span></div><ul><li><div>描述网络概念</div></li><li><div>验证网络配置</div></li><li><div>从命令行配置网络</div></li><li><div>编辑网络配置文件</div></li><li><div>配置主机名与名称解析</div></li></ul><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第一节：描述网络概念</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能描述服务器的网络寻址和路由的基本概念。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">TCP/IP网络模型：</span></div></div><ul><li><div>TCP/IP网络模型包含4层（应用、传输、网络、链路），描述不同协议如何进行互操作，</div></li></ul><div>     以便计算机通过互联网将流量从一台计算机发送到另一台计算机。</div><div>     <span style="color: rgb(0, 0, 255); font-weight: bold;">* 注意：</span>OSI七层模型与TCP/IP四层模型对比</div><div>     <img src="chapter12_files/OSI与TCP模型.jpg" type="image/jpeg" data-filename="OSI与TCP模型.jpg" width="497"/></div><div><br/></div><ul><li><div>应用层（Application Layer）：</div></li></ul><div>     1. 应用程序，常见应用包括SSH、HTTPS、NFS或CIFS、SMTP等。</div><ul><li><div>传输层（Transport Layer）：</div></li></ul><div>     1. 常见的传输层协议包括TCP、UDP协议。</div><div>     2. 常见的端口在/etc/services文件中可以找到常用和已注册的端口列表。</div><div>     3. 数据包在网络上通过socket（IP+端口）进行传输，每个数据包具有一个源socket和目标socket。</div><div>     4. 此信息可以在监控和过滤时使用。</div><ul><li><div>网络层（Internet Layer）：</div></li></ul><div>     1. 网络将数据从源到目的传输</div><div>     2. IPv4和IPv6是网络层协议，路由器在其间连接网络。</div><ul><li><div>链路层（Link Layer）：</div></li></ul><div>     1. 提供物理连接，常见的网络类型包括有线以太网（802.3）和无线局域网（802.11）。</div><div>     2. 每一物理设备具有一个硬件地址（MAC地址），用于标识局域网络段中数据包的目的地。</div><div><br/></div><div><span style="font-weight: bold;">描述网络接口名称：</span></div><ul><li><div>旧版红帽企业Linux中将eth0、eth1和eth2等名称用于各个网络接口。</div></li><li><div>当设备添加和移除，命名的机制可能会导致命名变化。</div></li><li><div>而且PCIe标准无法保证在启动时检测PCIe设备的顺序。</div></li><li><div>RHEL 7起开始采用新的命名体系，基于固件信息、PCI总线拓扑和网络设备类型，而且不会更改。</div></li><li><div>开头为接口类型：以太网接口en、WLAN接口wl</div></li><li><div>紧接为固件信息或PCI设备位置信息：</div></li></ul><div>     1. o<span style="font-style: italic; font-weight: bold;">N</span>：板载设备，例如 eno1 为板载以太网设备1，有时板载设备为 em<span style="font-style: italic; font-weight: bold;">N</span>。</div><div>     2. s<span style="font-style: italic; font-weight: bold;">N</span>：PCI热插拔设备，例如 ens3 表示PCI热插拔插槽3中的以太网卡。</div><div>     3. p<span style="font-style: italic; font-weight: bold;">M</span>s<span style="font-style: italic; font-weight: bold;">N</span>：</div><div>        a. 位于插槽 <span style="font-style: italic; font-weight: bold;">N</span> 中总线 <span style="font-style: italic; font-weight: bold;">M</span> 上的PCI设备，例如 wlp4s0 表示插槽0中PCI总线4上的WLAN卡。</div></div><div>        b. 如果该卡是⼀个多功能设备（可能是有多个端⼝的以太⽹卡，或是具有以太⽹外加其他⼀些</div><div>           功能的设备），设备名称中就可能会添加 f<span style="font-style: italic; font-weight: bold;">N</span>。</div><div>        c. 如下所示：<span style="font-weight: bold;">具有多个接口的万兆光纤以太网卡</span></div><div>           <img src="chapter12_files/IMG_20180522_174429.jpg" type="image/jpeg" data-filename="IMG_20180522_174429.jpg" width="450"/></div><div><br/></div><div>    <span style="color: rgb(0, 0, 255); font-weight: bold;"> * 注意：</span></div><div><span style="color: rgb(0, 0, 255); font-weight: bold;">     </span>  1. systemd项目源码 <span style="font-weight: bold;">src/udev/udev-builtin-net_id.c</span> 定义相应的网络接口定义规范。</div><div>          <img src="chapter12_files/Image.png" type="image/png" data-filename="Image.png" width="460"/></div><div>       2. <span style="font-weight: bold;">自Fedora 15开始采用全新的网络接口命名方式，称为一致性网络设备命名法</span></div><div><span style="font-weight: bold;">         （Consistent Network Device Naming，CNDN）。</span></div><div>       3. RHEL 6中的网络接口管理方式：</div><div>          a. RHEL 6中使用udev对网卡进行命名，使用<span style="font-weight: bold;">/etc/udev/rules.d/70-persistent-net.rules</span>。</div><div>          b. 该文件由/lib/udev/write_net_rules在每次启动时读取，其中的内容类似如下：</div><div>               SUBSYSTEM==&quot;net&quot;, ACTION==&quot;add&quot;, DRIVERS==&quot;?*&quot;, ATTR{address}==&quot;52:54:00:be:19:20&quot;, </div><div>               ATTR{type}==&quot;1&quot;, KERNEL==&quot;eth*&quot;, NAME=&quot;eth0&quot;</div><div>          c. 也就是说无论kernel启动时检测到的网络接口顺序如何，udev都会按照该文件里MAC地址对应的</div><div>             名字对网络接口进行命名。</div><div>          d. 如果某块网卡被替换，那么在启动时/lib/udev/write_net_rules会更新该70-persistent-net.rules</div><div>             文件，更新的方式并不是将该行里的MAC地址修改为新网卡的MAC地址，而是在该文件后面附上新的一行，</div><div>             并生成一个新的网卡名字。</div><div>       4. RHEL 7/8中的网络接口管理方式：</div><div>          a. RHEL 7/8仍然采用udev的机制，udev被集成至systemd-udevd中，且不使用70-persistent-net.rules</div><div>             文件，替换为 <span style="font-weight: bold;">/lib/udev/rules.d/71-biosdevname.rules </span>文件。</div><div>          b. systemd-udevd 调用 biosdevname（由biosdevname软件包提供），biosdevname 内部则调用 dmidecode </div><div>             等BIOS工具来获取PCI号等BIOS信息，从而为网卡命名。</div><div>          c. 过程如下：<span style="font-weight: bold;">systemd-udevd</span> <span style="font-weight: bold;">--<span style="font-weight: bold; font-family: &quot;DejaVu Sans Mono&quot;;">&gt;</span></span><span style="font-weight: bold;"> </span><span style="font-weight: bold;">71-biosdevname.rules --</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-weight: bold;">&gt;</span> <span style="font-weight: bold;">biosdevname --</span><span style="font-family: &quot;DejaVu Sans Mono&quot;; font-weight: bold;">&gt;</span> <span style="font-weight: bold;">dmidecode</span> </div><div>          <img src="chapter12_files/Image [1].png" type="image/png" data-filename="Image.png" width="556"/></div><div><br/></div><div>       5. 常用帮助文档与链接：</div><div>          <span style="font-weight: bold;">$ man biosdevname</span>：获取设备的BIOS名称</div><div>          <span style="font-weight: bold;">$ man 7 udev</span>：查看动态设备管理文档</div><div>          <a href="https://major.io/2015/08/21/understanding-systemds-predictable-network-device-names/">https://major.io/2015/08/21/understanding-systemds-predictable-network-device-names/</a></div><div>          理解系统网络设备命名方法</div><div><br/></div><div><span style="font-weight: bold;">IPv4地址：</span></div><ul><li><div>IPv4地址是4段8位二进制数字（32位），分为网络位（network part）和主机位（host part），</div></li></ul><div>     该格式称为“<span style="font-weight: bold;">点分十进制</span>”。</div><ul><li><div><span style="font-weight: bold;">不同子网可通过子网掩码进行区分，可使用形如255.255.255.0的语法表示，或使用无类别域间路由（CIDR）</span></div></li></ul><div><span style="font-weight: bold;">     表示法通过</span><span style="font-weight: bold;">形如/24前缀表示。</span></div><ul><li><div>同一子网的主机可以直接通信，不同子网的主机需要路由器通信。</div></li><li><div>网络管理员需要懂得子网划分，让子网拥有足够的IP地址，子网掩码用以确认子网划分。</div></li><li><div>特殊地址127.0.0.1指向localhost本地地址，网络127.0.0.0/8属于本地系统。</div></li><li><div>IPv4地址与子网掩码示例：</div></li></ul><div>     <img src="chapter12_files/Image [2].png" type="image/png" data-filename="Image.png" width="440"/></div><div><span style="color: rgb(0, 0, 255); font-weight: bold;">   * 注意：</span></div><div>     1. IPv4子网掩码与网络位（网络地址）的计算：</div><div>     <img src="chapter12_files/Image [3].png" type="image/png" data-filename="Image.png" width="499"/></div><div>     <img src="chapter12_files/Image [4].png" type="image/png" data-filename="Image.png" width="498"/></div><div>     2. <span style="font-weight: bold;">分别计算主机IPv4地址、子网掩码，再将两者进行与运算（0与1只取0）得到网络地址。</span></div><div><br/></div><div><span style="font-weight: bold;">IPv4路由：</span></div><ul><li><div>不管使用IPv4还是IPv6，网络流量都需要以主机到主机和网络到网络的形式进行传输。</div></li><li><div>每一主机都具有一个路由表，该表告诉主机如何路由特定网络的通信。</div></li><li><div>路由表（route table）查看示例：</div></li></ul><div>     1. 单路由示例</div><div>     <img src="chapter12_files/Image [5].png" type="image/png" data-filename="Image.png" width="498"/></div><div>     2.<span style="font-weight: bold;"> 多路由多网段示例：管理网段、NAS存储网段、生产网段。</span></div><div>     <img src="chapter12_files/IMG_20180427_095305.jpg" type="image/jpeg" data-filename="IMG_20180427_095305.jpg" width="496"/></div><div><br/></div><div><span style="font-weight: bold;">IPv4地址与路由配置：</span></div><ul><li><div>服务器可以在引导时从DHCP服务器自动配置其IPv4网络设置，并在租期到期前一直使用此地址。</div></li><li><div>若不使用DHCP服务器，可以将服务器配置为使用静态网络配置（static）。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">IPv6网络：</span></div><ul><li><div>IPv6网络旨在最终取代IPv4网络。</div></li><li><div><span style="font-weight: bold;">IPv6也可以在双栈模型（dual-stack model）中与IPv4并行使用。</span></div></li><li><div>在这种配置中，网络接口可以同时具有IPv6地址和IPv4地址，RHEL默认在双栈模式下运行。</div></li></ul><div><span style="font-weight: bold;">     </span><span style="font-weight: bold;"><img src="chapter12_files/Image [6].png" type="image/png" data-filename="Image.png" width="497"/></span></div><div><br/></div><div><span style="font-weight: bold;">IPv6地址：</span></div><ul><li><div><span style="font-weight: bold;">IPv6地址是一个128位数字（二进制），表示为八组以冒号分隔的四个十六进制半字节。</span></div></li><li><div><span style="font-weight: bold;">为了便于编写IPv6地址，不需要写出组中的前导零。</span></div></li><li><div>但每个冒号分隔组中必须至少写入一个数字。</div></li><li><div>一组或多组连续零可通过 :: 块来合并。</div></li><li><div>如果地址包含两个连续且长度相同的零组，则最好将每个组最左边的零组缩短为 ::，</div></li></ul><div>     最右边的组缩短为 :0: 。</div><ul><li><div>十六进制数字使用小写字母 a 到 f。</div></li></ul><div>     <img src="chapter12_files/Image [7].png" type="image/png" data-filename="Image.png" width="498"/></div><div>     <img src="chapter12_files/Image [8].png" type="image/png" data-filename="Image.png" width="497"/></div><div>     <img src="chapter12_files/Image [9].png" type="image/png" data-filename="Image.png" width="499"/></div><div>     <img src="chapter12_files/Image [10].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><div><span style="font-weight: bold;">IPv6子网划分：</span></div><ul><li><div>IPv6单播地址分为两部分：网络前缀、接口ID。</div></li><li><div>网络前缀标识子网。</div></li><li><div>同一子网上的任何两个子网接口都不能具有相同接口ID，接口ID可标识子网上的特定接口。</div></li><li><div><span style="font-weight: bold;">IPv6几乎所有普通地址均使用/64子网掩码，几乎可以容纳任意数量主机。</span></div></li><li><div><span style="font-weight: bold;">网络提供商通常提供/48位前缀，保留16位用于本地子网，64位用于接口ID。</span></div></li></ul><div>     <img src="chapter12_files/Image [11].png" type="image/png" data-filename="Image.png" width="381"/></div><div><br/></div><div><span style="font-weight: bold;">IPv6地址配置：</span></div><ul><li><div>IPv6地址支持DHCPv6、手动配置、无状态地址自动配置（SLAAC）。</div></li><li><div>RHEL 8中的dhcp软件包和radvd软件包分别提供DHCPv6和SLAAC支持。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">主机名与IP地址：</span></div><ul><li><div>Linux有多种机制可以将主机名映射到IP地址，统称为名称解析。</div></li><li><div>手动更新静态设置/etc/hosts实现名称解析。</div></li><li><div>DNS动态获取由DHCP或/etc/resolve.conf中配置的DNS服务器来获取。</div></li></ul><div><br/></div><div>     <span style="color: rgb(250, 122, 0); font-weight: bold;">练习 P401：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">DESCRIBING NETWORKING CONCEPTS</span></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第二节：验证网络配置</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能使用命令行工具测试与检查当前的网络配置。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">识别网络接口：</span></div><ul><li><div><span style="font-weight: bold;">$ ip link show</span>：列出系统上所有的可用网络接口与MAC地址（link/ether字段）</div></li></ul><div>     <img src="chapter12_files/Image [12].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><div><span style="font-weight: bold;">显示IP地址：</span></div><ul><li><div><span style="font-weight: bold;">$ ip addr show &lt;</span><span style="font-style: italic; font-weight: bold;">interface_name</span><span style="font-weight: bold;">&gt;</span>：查看指定网络接口的IP地址</div></li></ul><div>     ip address show命令或ip a s命令与以上命令相同。 </div><div>     <img src="chapter12_files/Image [13].png" type="image/png" data-filename="Image.png" width="498"/></div><div>     <img src="chapter12_files/Image [14].png" type="image/png" data-filename="Image.png" width="499"/></div><div><br/></div><div><span style="font-weight: bold;">显示性能统计信息：</span></div><ul><li><div><span style="font-weight: bold;">$ ip -s link show &lt;</span><span style="font-style: italic; font-weight: bold;">interface_name</span><span style="font-weight: bold;">&gt;</span>：查看指定网络接口的性能</div></li></ul><div>     <img src="chapter12_files/Image [15].png" type="image/png" data-filename="Image.png" width="496"/></div><div>     1. 命令输出字段说明：</div><div>        a. <span style="font-weight: bold;">RX</span>（received）：网络接口接收的数据包</div><div>        b. <span style="font-weight: bold;">TX</span>（Transmitted）：网络接口发送的数据包</div><div>        c. 数据包错误数与丢包数</div><div><br/></div><div><span style="font-weight: bold;">检查主机之间的连接：</span></div><ul><li><div>ping命令与ping6命令用于测试主机间的连接。</div></li><li><div>ping6命令为ping命令的软链接，且与ping -6命令相同。</div></li><li><div>该命令默认持续运行，可使用Ctrl+C终止命令。</div></li></ul><div>     <img src="chapter12_files/Image [16].png" type="image/png" data-filename="Image.png" width="499"/></div><div>     <img src="chapter12_files/Image [17].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div></div><ul><li><div><span style="font-weight: bold;">ping本地链路地址和本地链路全节点多播组（ff02::1）时，必须使用作用域标识符</span></div></li></ul><div><span style="font-weight: bold;">    （如ff02::1%ens3）来显式指定要使用的网络接口。</span></div><ul><li><div>如果遗漏，则将显示错误 connect: Invalid argument。</div></li><li><div><span style="font-weight: bold;">对ff02::1执行ping可能有助于找到本地网络上的其他IPv6节点。</span>     </div></li></ul><div>     <img src="chapter12_files/Image [18].png" type="image/png" data-filename="Image.png" width="499"/></div><div><br/></div><ul><li><div>可使用IPv6地址登录远程主机，如下所示：</div></li></ul><div>     <span style="font-weight: bold;">$ ssh &lt;</span><span style="font-style: italic; font-weight: bold;">remoteuser</span><span style="font-weight: bold;">&gt;@&lt;</span><span style="font-style: italic; font-weight: bold;">remotehost_ipv6</span><span style="font-weight: bold;">&gt;%&lt;</span><span style="font-style: italic; font-weight: bold;">local_interface_by_ipv6</span><span style="font-weight: bold;">&gt;</span></div><div>     <img src="chapter12_files/Image [19].png" type="image/png" data-filename="Image.png" width="577"/></div><div><br/></div><div><span style="font-weight: bold;">显示路由表：</span></div><ul><li><div><span style="font-weight: bold;">$ ip route show</span>：查看系统路由表（推荐）</div></li><li><div>$ route -n：查看系统路由表</div></li></ul><div>     <img src="chapter12_files/Image [20].png" type="image/png" data-filename="Image.png" width="498"/></div><div><span style="color: rgb(0, 0, 255); font-weight: bold;">   * 注意：</span></div><div>     1. iproute软件包提供：ip、ss。</div><div>     2. net-tools软件包提供：ifconfig、route、netstat。</div><div>     3. 查看IP地址也可使用ifconfig命令，查看系统路由表也可使用route命令。</div><div>     4. 但net-tools软件包不再提供维护，将被淘汰使用，推荐使用iproute软件包提供的网络工具。</div><div><br/></div><ul><li><div><span style="font-weight: bold;">$ ip -6 route show</span>：查看系统IPv6路由表（忽略unreachable）</div></li></ul><div>     <img src="chapter12_files/Image [21].png" type="image/png" data-filename="Image.png" width="499"/></div><div><br/></div><div><span style="font-weight: bold;">追踪流量采用的路由：</span></div><ul><li><div>使用traceroute命令或tracepath命令追踪网络流量通过多个路由器到达远程主机的路径。</div></li><li><div><span style="font-weight: bold;">两者均使用UDP包追踪网络流量路径，但部分网络屏蔽UDP与ICMP流量。</span></div></li><li><div>默认traceroute命令不安装。</div></li><li><div><span style="font-weight: bold;">traceroute命令可使用UDP包（默认）、ICMP（-I）与TCP包（-T）追踪流量路径。</span></div></li><li><div>每一行均为下一跳的路由器地址。</div></li></ul><div>     <img src="chapter12_files/Image [22].png" type="image/png" data-filename="Image.png" width="497"/></div><div>     <img src="chapter12_files/Image [23].png" type="image/png" data-filename="Image.png" width="577"/></div><div><br/></div><ul><li><div>tracepath6和traceroute -6命令等效于IPv6版本的tracepath和traceroute。</div></li></ul><div><span style="font-weight: bold;">     </span><span style="font-weight: bold;"><img src="chapter12_files/Image [24].png" type="image/png" data-filename="Image.png" width="498"/></span></div><div><br/></div><div><span style="font-weight: bold;">端口与服务故障排除：</span></div><ul><li><div>使用ss或netstat显示网络连接信息，ss用以替换netstat。</div></li><li><div><span style="font-weight: bold;">$ ss -ta</span>：查看系统监听与建立的所有TCP套接字</div></li></ul><div>     <img src="chapter12_files/Image [25].png" type="image/png" data-filename="Image.png" width="501"/></div><div>     </div><div>     <img src="chapter12_files/Image [26].png" type="image/png" data-filename="Image.png" width="499"/></div><div>     <img src="chapter12_files/Image [27].png" type="image/png" data-filename="Image.png" width="499"/></div><div><br/></div><div>     <span style="color: rgb(250, 122, 0); font-weight: bold;">练习 P411：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">VALIDATING NETWORK CONFIGURATION</span></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第三节：从命令行配置网络</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能使用nmcli命令管理网络设置与设备。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">描述NetworkManager概念：</span></div><ul><li><div>RHEL 8中使用NetworkManager服务监控和管理网络。</div></li><li><div>nmcli命令用于配置网络，配置保存在/etc/sysconfig/network-scripts目录中。</div></li><li><div>只有root用户才能修改网络配置。</div></li><li><div>其中device为网络接口、connection为针对device的网络配置集合。</div></li><li><div>针对任一device，同一时间只有一个connection处于活动状态。</div></li><li><div>每个connection具有一个名称或ID。</div></li></ul><div><br/></div><div><span style="color: rgb(0, 0, 255); font-weight: bold;">   * 注意：</span></div><div>     1. RHEL 7中可使用network或NetworkManager管理网络，但两者同时只能使用一种，否则冲突。</div><div>     2. RHEL 8中全面使用NetworkManager，默认已不再使用也不安装network。</div><div>     3. <span style="font-weight: bold;">D-Bus为消息总线服务，用于实现进程间通信（IPC），</span><span style="font-weight: bold;">NetworkManager使用D-Bus实现网络配置。</span></div><div>     4. <span style="font-weight: bold;">nmcli命令为NetworkMananger的命令行控制工具，必须启动NetworkManager才能使用。</span></div><div>     5. D-Bus与Networkmanager为freedesktop.org的两个子项目。</div><div>        <img src="chapter12_files/Image [28].png" type="image/png" data-filename="Image.png" width="554"/></div><div>        <img src="chapter12_files/Image [29].png" type="image/png" data-filename="Image.png" width="474"/></div><div><br/></div><div><span style="font-weight: bold;">查看联网信息：</span></div><ul><li><div><span style="font-weight: bold;">$ nmcli device status</span>：查看系统上所有的网络接口设备状态</div></li></ul><div>     <img src="chapter12_files/Image [30].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><ul><li><div><span style="font-weight: bold;">$ nmcli connection show</span>：查看系统上所有的网络连接（网络接口配置文件）状态</div></li><li><div>$ nmcli connection show --active：查看系统上所有激活的网络连接</div></li></ul><div>     <img src="chapter12_files/Image [31].png" type="image/png" data-filename="Image.png" width="579"/></div><div><br/></div><div><span style="font-weight: bold;">添加网络连接：</span></div><ul><li><div>使用nmcli connection add命令添加网络连接。</div></li></ul><div>     1. 示例一：IP地址由DHCP自动获取</div><div>     <img src="chapter12_files/Image [32].png" type="image/png" data-filename="Image.png" width="577"/></div><div><br/></div><div>     2. 示例二：IP地址手动设置</div><div>     <img src="chapter12_files/Image [33].png" type="image/png" data-filename="Image.png" width="581"/></div><div>     a. 该网络连接中IP地址依然将通过DHCP自动获取，需要将其关闭，如下所示：</div><div>        <span style="font-weight: bold;">$ nmcli connection modify &lt;</span><span style="font-style: italic; font-weight: bold;">connection_name</span><span style="font-weight: bold;">&gt; ipv4.method manual</span></div><div>     b. 该网络接口在系统启动过程中将自动启动，若未自动启动，即 ONBOOT=no，执行以下命令：</div><div>        <span style="font-weight: bold;">$ nmcli connection modify &lt;</span><span style="font-style: italic; font-weight: bold;">connection_name</span><span style="font-weight: bold;">&gt; connection.autoconnect yes</span></div><div><br/></div><ul><li><div>以下使用静态IPv6和IPv4地址为eno2设备创建eno2连接，且使用IPv6地址和网络前缀</div></li></ul><div>     2001:db8:0:1::c000:207/64及默认IPv6网关2001:db8:0:1::1，以及IPv4地址和网络前缀</div><div>     192.0.2.7/24及默认IPv4网关192.0.2.1，启动时自动连接。</div><div>     <img src="chapter12_files/Image [34].png" type="image/png" data-filename="Image.png" width="577"/></div><div><br/></div><div><span style="font-weight: bold;">控制网络连接：</span></div></div><ul><li><div><span style="font-weight: bold;">$ nmcli connection up &lt;</span><span style="font-style: italic; font-weight: bold;">connection_name</span><span style="font-weight: bold;">&gt;</span>：激活网络连接</div></li><li><div><span style="font-weight: bold;">$ nmcli device disconnection &lt;</span><span style="font-style: italic; font-weight: bold;">device_name</span><span style="font-weight: bold;">&gt;</span>：断开与网络接口的连接并将其关闭</div></li></ul><div><br/></div><div>   <span style="color: rgb(0, 0, 255); font-weight: bold;">* 注意：</span></div><div>     1. nmcli connection down &lt;<span style="font-style: italic;">connection_name</span>&gt;命令并非是停用网络接口的最佳方法，因为它只关闭网络连接。</div><div>     2. 但在默认情况下，大部分有线系统连接是在启用了autoconnect的情况下配置的。</div><div>     3. 这将在其网络接口可用后立即激活连接。</div><div>     4. 断开网络接口并将其关闭使用以上命令。</div><div><br/></div><div><span style="font-weight: bold;">修改网络连接设置：</span></div><ul><li><div><span style="font-weight: bold;">$ nmcli connection show &lt;</span><span style="font-style: italic; font-weight: bold;">connection_name</span><span style="font-weight: bold;">&gt;</span>：查看网络连接的详细状态</div></li><li><div>nmcli connection modify &lt;<span style="font-style: italic;">connection_name</span>&gt;命令可用于更改连接的设置，并同步更新</div></li></ul><div>     /etc/sysconfig/network-scripts/ifcfg-&lt;<span style="font-style: italic;">connection_name</span>&gt;文件。</div><div>     <img src="chapter12_files/Image [35].png" type="image/png" data-filename="Image.png" width="499"/></div><div>     <img src="chapter12_files/Image [36].png" type="image/png" data-filename="Image.png" width="500"/></div><div><br/></div><ul><li><div>如果某个连接之前通过DHCPv4服务器获取配置，设置ipv4.method从auto变为manual静态设置。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">删除网络连接：</span></div><ul><li><div><span style="font-weight: bold;">$ nmcli connection delete &lt;</span><span style="font-style: italic; font-weight: bold;">connection_name</span><span style="font-weight: bold;">&gt;</span>：删除网络连接</div></li><li><div>删除网络连接后，将同时删除/etc/sysconfig/network-scripts/ifcfg-&lt;<span style="font-style: italic;">connection_name</span>&gt;文件。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">命令摘要：</span></div><ul><li><div>常用nmcli命令示例：</div></li></ul><div>     <img src="chapter12_files/Image [37].png" type="image/png" data-filename="Image.png" width="500"/></div><div><br/></div><div><span style="color: rgb(0, 0, 255); font-weight: bold;">   * 注意：</span></div><div>      <span style="font-weight: bold;">$ man 5 nm-settings</span>：查看NetworkManager配置的详细参数信息   </div><div>      <span style="font-weight: bold;">$ man nmcli-examples</span>：查看nmcli命令的使用示例</div><div><br/></div><div>     <span style="color: rgb(250, 122, 0); font-weight: bold;">练习 P420：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">CONFIGURING NETWORKING FROM THE COMMAND LINE</span>     </div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第四节：编辑网络配置文件</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能通过编辑配置文件修改网络配置。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">描述连接配置文件：</span></div><ul><li><div>默认情况下，通过nmcli connection modify &lt;<span style="font-style: italic;">connection_name</span>&gt;命令进行的更改会</div></li></ul><div>     自动保存到/etc/sysconfig/network-scripts/ifcfg-&lt;<span style="font-style: italic;">connection_name</span>&gt;中。</div><ul><li><div><span style="font-weight: bold;">还可以手动编辑此文件，然后运行nmcli connection reload命令以便NetworkManager</span></div></li></ul><div><span style="font-weight: bold;">     读取配置更改。</span></div><div><br/></div><ul><li><div>出于向后兼容性（<span style="font-weight: bold;">backward-compatibility</span>）的原因，此文件中保存的指令具有不同于</div></li></ul><div>     nm-settings (5) 名称的名称和语法。</div><ul><li><div>下表将部分关键设置名称映射到 ifcfg-* 指令：</div></li></ul><div><span style="font-weight: bold;">     </span><span style="font-weight: bold;"><img src="chapter12_files/Image [38].png" type="image/png" data-filename="Image.png" width="500"/></span></div><div>     <img src="chapter12_files/Image [39].png" type="image/png" data-filename="Image.png" width="503"/></div><div><br/></div><div><span style="font-weight: bold;">修改网络连接：</span></div><ul><li><div>可以通过直接编辑连接配置文件来配置网络。</div></li><li><div>连接配置文件控制单个网络设备的软件接口。</div></li></ul><div><br/></div><ul><li><div>如下所示：/etc/sysconfig/network-scripts/ifcfg-eth1</div></li></ul><div>     <img src="chapter12_files/Image [40].png" type="image/png" data-filename="Image.png" width="498"/></div><div><br/></div><ul><li><div><span style="font-weight: bold;">修改完配置后，使用nmcli connection reload使NetworkManager读取更改的配置，</span></div></li></ul><div><span style="font-weight: bold;">     同时还需要将网络连接接口重启。</span></div><ul><li><div>如下所示：</div></li></ul><div>  <span style="color: rgb(0, 0, 255); font-weight: bold;">   </span> <span style="color: rgb(227, 0, 0); font-weight: bold;">$ nmcli connection reload</span></div><div><span style="color: rgb(227, 0, 0); font-weight: bold;">      $ nmcli connection down &lt;</span><span style="color: rgb(227, 0, 0); font-style: italic; font-weight: bold;">connection_name</span><span style="color: rgb(227, 0, 0); font-weight: bold;">&gt;</span></div><div><span style="color: rgb(227, 0, 0); font-weight: bold;">      $ nmcli connection up &lt;</span><span style="color: rgb(227, 0, 0); font-style: italic; font-weight: bold;">connection_name</span><span style="color: rgb(227, 0, 0); font-weight: bold;">&gt;  </span></div><div>    </div><div>  <span style="color: rgb(0, 0, 255); font-weight: bold;"> * 注意：</span></div><div>     1. <span style="font-weight: bold;">每台主机中只能有一个网络接口配置为默认路由，其网络连接文件中 DEFROUTE=yes，</span></div><div><span style="font-weight: bold;">        即每个主机的路由表中只能具有一个默认路由！</span></div><div>     2. 若主机中除默认路由，还需配置多网段路由，如下所示：</div><div>        <img src="chapter12_files/Image [41].png" type="image/png" data-filename="Image.png" width="556"/></div><div>     3. <span style="font-weight: bold;">/etc/sysconfig/network-scripts/route-eth</span><span style="font-style: italic; font-weight: bold;">X</span>：配置网络接口多网段路由</div><div><br/></div><div>     <span style="color: rgb(250, 122, 0); font-weight: bold;">练习 P428：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">EDITING NETWORK CONFIGURATION FILES</span></div><div><br/></div><div><br/></div><div><span style="font-weight: bold;">第五节：配置主机名与名称解析</span></div><div><span style="font-weight: bold;">目标：</span></div><ul><li><div>完成本节后，学生应该能配置服务器的静态主机名及名称解析，并测试其结果。</div></li></ul><div><br/></div><div><span style="font-weight: bold;">更改系统主机名：</span></div><ul><li><div>$ hostname：显示系统主机名或临时修改主机名</div></li><li><div>编辑/etc/hostname或使用hostnamectl命令可以永久修改主机名。</div></li></ul><div>     <img src="chapter12_files/Image [42].png" type="image/png" data-filename="Image.png" width="498"/></div><div>     <img src="chapter12_files/Image [43].png" type="image/png" data-filename="Image.png" width="499"/></div><div><br/></div><div><span style="font-weight: bold;">配置名称解析：</span></div><ul><li><div>/etc/nsswitch.conf文件定义域名查找位置和顺序，默认先检查/etc/hosts文件内容。</div></li><li><div>其次会查找/etc/resolv.conf文件中的DNS服务器，最多可以配置3台DNS服务器。</div></li></ul><div>     <img src="chapter12_files/Image [44].png" type="image/png" data-filename="Image.png" width="502"/></div><div>     <img src="chapter12_files/Image [45].png" type="image/png" data-filename="Image.png" width="502"/></div><div><br/></div><div><span style="font-weight: bold;">测试DNS名称解析：</span></div><ul><li><div>$ hostname &lt;<span style="font-style: italic;">hostname</span>&gt;：测试与DNS服务器的连接性</div></li></ul><div>     <img src="chapter12_files/Image [46].png" type="image/png" data-filename="Image.png" width="507"/></div><div><br/></div><ul><li><div>/etc/sysconfig/network-scripts/ifcfg-&lt;<span style="font-style: italic;">connection_name</span>&gt;中设置的DNS会</div></li></ul><div>     更新/etc/resolv.conf中的DNS。</div><ul><li><div>PEERDNS参数是指BOOTPROTO=dhcp时，是否使用DHCP服务器指定的DNS地址，并更新/etc/resolv.conf。</div></li></ul><div><br/></div><div><span style="color: rgb(0, 0, 255); font-weight: bold;">* RHEL 8配置链路聚合：</span></div><ul><li><div>使用teamd创建链路聚合，必须先加载team内核模块。</div></li></ul><div>     <img src="chapter12_files/Image [47].png" type="image/png" data-filename="Image.png" width="500"/></div><div><br/></div><ul><li><div>创建team逻辑网络接口、添加team-slave端口、启用team逻辑网络接口。</div></li></ul><div>     <img src="chapter12_files/Image [48].png" type="image/png" data-filename="Image.png" width="577"/></div><div><br/></div><div><span style="color: rgb(0, 0, 255); font-weight: bold;">* RHEL 8创建与配置Linux bridge：</span></div><ul><li><div>创建Linux bridge必须先加载bridge内核模块。</div></li></ul><div>     $ lsmod | grep bridge</div><div><br/></div><ul><li><div>创建过程如下所示：</div></li></ul><div>     <span style="font-weight: bold;">$ nmcli connection add type bridge con-name br0 ifname br0 \</span></div><div><span style="font-weight: bold;">       ipv4.addresses &lt;</span><span style="font-style: italic; font-weight: bold;">ipaddress</span><span style="font-weight: bold;">&gt;/&lt;</span><span style="font-style: italic; font-weight: bold;">prefix</span><span style="font-weight: bold;">&gt; ipv4.method manual \</span></div><div><span style="font-weight: bold;">       ipv4.never-default yes bridge.stp no</span></div><div>     # 创建Linux bridge及配置文件，并指定IPv4地址与子网掩码、禁用DHCP、禁用默认路由与禁用STP协议。</div><div><br/></div><div>     <span style="font-weight: bold;">$ nmcli connection add type bridge-slave con-name br0-eth1 ifname eth1 master br0</span></div><div>     # 添加Linux bridge br0的网卡接口eth1及配置文件</div><div><br/></div><div>     <span style="font-weight: bold;">$ nmcli connection reload</span></div><div>     # 重载NetworkManager网络配置文件</div><div>     $ nmcli connection show --active</div><div>     # 查看激活的网络连接    </div><div>     <img src="chapter12_files/Image [49].png" type="image/png" data-filename="Image.png" width="580"/></div><div><br/></div><div>     <span style="font-weight: bold;">$ </span><span style="font-weight: bold;">bridge link show | \</span></div><div><span style="font-weight: bold;">       awk 'BEGIN{ print &quot;Bridge\t\tInterfaces&quot;} { sub(&quot;:&quot;,&quot;&quot;,$2); print $7&quot;\t\t&quot;$2 }'</span></div><div>     # 查看已有的Linux bridge与其接口名称</div><div>     <img src="chapter12_files/Image [50].png" type="image/png" data-filename="Image.png" width="582"/></div><div><br/></div><div>     <span style="color: rgb(250, 122, 0); font-weight: bold;">练习 P436：</span><span style="color: rgb(250, 122, 0); font-weight: bold;">CONFIGURING HOST NAMES AND NAME RESOLUTION</span></div><div><span style="color: rgb(250, 122, 0); font-weight: bold;">     Lab P440：MANAGING NETWORKING</span></div><div><br/></div></div><div><br/></div><div><br/></div></span>
</div></body></html> 